<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="INLAspacetime">
<title>A barrier model illustration • INLAspacetime</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="A barrier model illustration">
<meta property="og:description" content="INLAspacetime">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">INLAspacetime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6.104</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../../articles/web/barrierExample.html">Spatial models for domains with barrier</a>
    <a class="dropdown-item" href="../../articles/web/piemonte.html">Spatio-temporal examples</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/eliaskrainski/INLAspacetime/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>A barrier model illustration</h1>
                        <h4 data-toc-skip class="author">Elias T
Krainski</h4>
            
            <h4 data-toc-skip class="date">Created in March, 2023. Last
update: Tue 01 Aug, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/eliaskrainski/INLAspacetime/blob/HEAD/vignettes/web/barrierExample.Rmd" class="external-link"><code>vignettes/web/barrierExample.Rmd</code></a></small>
      <div class="d-none name"><code>barrierExample.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h2>
<p>In this tutorial we illustrate a new implementation of the model
proposed in <span class="citation">Bakka et al. (2019)</span>. It
consider the problem of modeling over a spatial domain accounting for
physical barriers. The original implementation is illustrated in <a href="https://haakonbakkagit.github.io/btopic128.html" class="external-link">this
tutorial</a>. The re-implementation consider a new (faster)
computational method available in the <strong>INLA</strong> package. See
details at the end of this vignette to update old working code to use
this new implementation.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Suppose that there is a phenomena that varies over a spatial domain.
Models usually consider correlation between observations made.
Considering a pair of observations, the correlation is usually specified
as a function of the distance between the location sites from where
these observations were collected. If there is a barrier in the spatial
domain, this correlation for a pair of observations taken from sites in
different sides of the barrier shall consider the barrier. In resume, it
should no longer be just a function of the distance. Basically, the
correlation between points in two different sides of the barrier should
decay faster (than the usual) to zero and “does not cross the
domain”.</p>
<p>In order to illustrate the problem, let us define a rectangle as our
spatial domain:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rxy</span><span class="op">)</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">rxy</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">rxy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">domain.xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>We will now set the barrier as the two polygons defined as
follows</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">barrier1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">*</span><span class="va">pi</span>, length<span class="op">=</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.7</span> <span class="op">+</span> <span class="fl">0.50</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">*</span><span class="va">pi</span>, length<span class="op">=</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.75</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">barrier2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">1.50</span>, <span class="fl">1.50</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span><span class="op">)</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>, <span class="fl">0.33</span>, <span class="fl">0.40</span>, <span class="fl">0.40</span>, <span class="fl">0.33</span><span class="op">)</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Define the objects using the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">domain.xy</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">barriers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_multipolygon</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">barrier1</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">barrier2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize these polygons in order to make the problem
clear:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">gg0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gg0</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">domain</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">barriers</span>, fill <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate system already present. Adding new coordinate system, which will</span></span>
<span><span class="co">#&gt; replace the existing one.</span></span></code></pre></div>
<p><img src="barrierExample_files/figure-html/domainvis-1.png" width="99%" style="display: block; margin: auto;"></p>
<p>The problem is to model data in both sides of the barrier considering
that the correlation between then should account for the barrier. The
proposed method in <span class="citation">Bakka et al. (2019)</span>
models the entire domain, including the barrier. To deal with the
barrier, the correlation range is set to be reasonable shorter over the
barrier domain than the one at the domain of interest. This idea is
simple and does not add any parameter in the usual stationary model.
Furthermore, it can be implemented with any inferential method.</p>
<p>In <span class="citation">Bakka et al. (2019)</span>, the proposed
method consider the Stochastic Partial Differential Equations - SPDE
approach proposed in <span class="citation">Lindgren, Rue, and Lindström
(2011)</span>. The implementation illustrated in <a href="https://haakonbakkagit.github.io/btopic128.html" class="external-link">this tutorial</a>
deals with a discretization of the domain. The discretization should be
considered with some care. The fraction fixed for the analysis interplay
with the width of the barrier. One should choose a small enough
fraction, see details in <span class="citation">Bakka et al.
(2019)</span>.</p>
<p>We first load the other packages that will be used in this
tutorial.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">#&gt; which was just loaded, will retire in October 2023.</span></span>
<span><span class="co">#&gt; Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">#&gt; It may be desirable to make the sf package available;</span></span>
<span><span class="co">#&gt; package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">#&gt; The sp package is now running under evolution status 2</span></span>
<span><span class="co">#&gt;      (status 2 uses the sf package in place of rgdal)</span></span>
<span><span class="co">#&gt; This is INLA_23.06.29 built 2023-06-30 04:18:35 UTC.</span></span>
<span><span class="co">#&gt;  - See www.r-inla.org/contact-us for how to get help.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eliaskrainski/INLAspacetime" class="external-link">INLAspacetime</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-definition-and-discretization">Model definition and discretization<a class="anchor" aria-label="anchor" href="#model-definition-and-discretization"></a>
</h2>
<p>Let us consider that there is an underlying random field over the
specified domain. This random field will be discretized using the mesh
so that a precision matrix is defined for the distribution at the mesh
nodes. We will define the barrier model as proposed in <span class="citation">Bakka et al. (2019)</span> which make use of a
triangulation.</p>
</div>
<div class="section level2">
<h2 id="mesh-and-triangles">Mesh and triangles<a class="anchor" aria-label="anchor" href="#mesh-and-triangles"></a>
</h2>
<p>The solution consider a discretization of the spatial domain and the
simplest one is using triangles. Therefore we start with the following
mesh made up of small triangles in the domain and bigger around it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.2d.html" class="external-link">inla.mesh.2d</a></span><span class="op">(</span></span>
<span>    loc.domain <span class="op">=</span> <span class="va">domain.xy</span>, </span>
<span>    max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="op">*</span> <span class="va">r</span>,</span>
<span>    offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span> <span class="op">*</span> <span class="va">r</span>,</span>
<span>    cutoff <span class="op">=</span> <span class="fl">0.01</span> <span class="op">*</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="va">mesh</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="co">#&gt; [1] 4364</span></span></code></pre></div>
<p>The solution needs the triangles inside the barrier domain to be
identified. For each triangle center we check if it is inside or not of
the barrier domain and and create a vector to identify to which domain
is each triangle center inside</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triBarrier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/fm_contains.html" class="external-link">fm_contains</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">barriers</span>, </span>
<span>  y <span class="op">=</span> <span class="va">mesh</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"centroid"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize the mesh and color the triangle centers using the
<strong>ggplot</strong> methods from the <strong>inlabru</strong>
package</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">triCenters.xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span><span class="va">mesh</span><span class="op">$</span><span class="va">graph</span><span class="op">$</span><span class="va">tv</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span></span>
<span>  <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span><span class="va">mesh</span><span class="op">$</span><span class="va">graph</span><span class="op">$</span><span class="va">tv</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span></span>
<span>  <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span><span class="va">mesh</span><span class="op">$</span><span class="va">graph</span><span class="op">$</span><span class="va">tv</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span></span>
<span><span class="va">gg0</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">triCenters.xy</span><span class="op">[</span><span class="va">triBarrier</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>        y <span class="op">=</span> <span class="va">triCenters.xy</span><span class="op">[</span><span class="va">triBarrier</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="barrierExample_files/figure-html/vmesh-1.png" width="99%" style="display: block; margin: auto;"></p>
<p>Notice that the mesh goes beyond the domain area including a boundary
extension. Then we also had defined the barrier so that it is also
defined in this boundary. Therefore, when building the model over this
discretization, the barrier will be well defined and the behavior of the
process will be as intended.</p>
<div class="section level3">
<h3 id="precision-matrix">Precision matrix<a class="anchor" aria-label="anchor" href="#precision-matrix"></a>
</h3>
<p>The parameters in this model are the range and the marginal variance,
We also define the range parameter in the barrier so that the method
works. We consider the range for the barrier as a fraction of the range
over the domain. We just use half of the average rectangle edges as the
range in the domain and 10% of it in the barrier.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">(</span><span class="va">ranges</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 4.0 0.4</span></span></code></pre></div>
<p>We now have to compute the Finite Element matrices needed for the
model discretization, as detailed in <span class="citation">Bakka et al.
(2019)</span>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bfem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mesh2fem.html">mesh2fem.barrier</a></span><span class="op">(</span><span class="va">mesh</span>, <span class="va">triBarrier</span><span class="op">)</span></span></code></pre></div>
<p>We now build the precision matrix with</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/barrier.html" class="external-link">inla.barrier.q</a></span><span class="op">(</span><span class="va">bfem</span>, ranges <span class="op">=</span> <span class="va">ranges</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="correlation">Correlation<a class="anchor" aria-label="anchor" href="#correlation"></a>
</h3>
<p>We can use the discretized model to compute correlation between pairs
of points in order to check the properties of the model. Let us define a
function that computes the correlation from a given set of location to
each mesh node location.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">localCorrel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">locs</span>, <span class="va">mesh</span>, <span class="va">Q</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">locs</span><span class="op">)</span></span>
<span>  <span class="va">ii</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nl</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span></span>
<span>      <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">locs</span><span class="op">)</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">locs</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span>, <span class="va">nl</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span></span>
<span>    <span class="va">b</span><span class="op">[</span><span class="va">ii</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/qsolve.html" class="external-link">inla.qsolve</a></span><span class="op">(</span><span class="va">Q</span>, <span class="va">b</span><span class="op">)</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/qinv.html" class="external-link">inla.qinv</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span></span>
<span>    <span class="va">cc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="va">s</span> <span class="op">*</span> <span class="va">s</span><span class="op">[</span><span class="va">ii</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Consider a set of locations and compute the correlations with</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mcorrels</span> <span class="op">&lt;-</span> <span class="fu">localCorrel</span><span class="op">(</span><span class="va">locs</span>, <span class="va">mesh</span>, <span class="va">Q</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mcorrels</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 4364    4</span></span></code></pre></div>
<p>We have the correlation from each mesh node to each of the specified
locations. We would like to visualize it as an image so that we have
these correlation from the location to “everywhere”. Let us build a
projector to project any vector from the mesh nodes to a fine grid and
projected with</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.projector</a></span><span class="op">(</span></span>
<span>    <span class="va">mesh</span>,</span>
<span>    xlim <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>,</span>
<span>    dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">500</span> <span class="op">*</span> <span class="va">rxy</span><span class="op">/</span><span class="va">r</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">gcorrels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>  <span class="va">pgrid</span>, field <span class="op">=</span> <span class="va">mcorrels</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now create a <code>data.frame</code> with the expanded
coordinates of the pixels</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">pgrid</span><span class="op">$</span><span class="va">x</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pgrid</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">pgrid</span><span class="op">$</span><span class="va">y</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pgrid</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The correlations can be projected and prepared for plotting with</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ggcorrels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span></span>
<span>  <span class="va">rbind</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">grid.df</span>, </span>
<span>               loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.1f"</span>, <span class="va">locs</span><span class="op">[</span><span class="va">l</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.1f"</span>, <span class="va">locs</span><span class="op">[</span><span class="va">l</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, </span>
<span>               correlation <span class="op">=</span> <span class="va">gcorrels</span><span class="op">[</span>, <span class="va">l</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In order to help the visualization of correlations, we will dropped
the pixels with small correlations, less than <span class="math inline">\(0.1\)</span>. We can now visualize the images
with</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg0</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">ggcorrels</span><span class="op">[</span><span class="va">ggcorrels</span><span class="op">$</span><span class="va">correlation</span><span class="op">&gt;</span><span class="fl">0.1</span>, <span class="op">]</span>, </span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">correlation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">loc</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">add.b0</span> <span class="op">+</span> <span class="va">gg.add</span> <span class="co">## look to the appendix for the code for this</span></span></code></pre></div>
<p><img src="barrierExample_files/figure-html/ggcorrels-1.png" width="99%" style="display: block; margin: auto;"></p>
<p>Notice that the model is also defined in the barrier domain.
Therefore we can do computations at the barrier. We visualized the
correlation over the barriers as well, and added the barrier borders, so
that we can see the action of the short spatial range over the barriers.
This visual inspection helps to verify if the short range over the
barrier domain was set small enough.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-simulation">Data simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h2>
<p>We consider that the random field is observed with noise. We first
sample from the random field distribution.</p>
<div class="section level3">
<h3 id="a-random-field-sample">A random field sample<a class="anchor" aria-label="anchor" href="#a-random-field-sample"></a>
</h3>
<p>There are several algorithms to sample from a random field specified
over a continuous domain without barriers. We will use the already
defined precision matrix to draw a sample at the mesh nodes with</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/qsample.html" class="external-link">inla.qsample</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">Q</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#&gt; Warning in inla.qsample(1, Q, seed = 1): Since 'seed!=0', parallel model is</span></span>
<span><span class="co">#&gt; disabled and serial model is selected</span></span></code></pre></div>
<p>These values sampled at the mesh nodes can be projected to a set of
small pixels for visualization purpose with</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ugrid.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span><span class="va">pgrid</span>, field <span class="op">=</span> <span class="va">u</span><span class="op">)</span></span></code></pre></div>
<p>We can now visualize the projected simulated values at the small
pixels, inclusive those values in the barriers.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid.df</span><span class="op">$</span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">ugrid.sim</span><span class="op">)</span></span>
<span><span class="va">gg0</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">grid.df</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">u</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">add.b0</span> <span class="op">+</span> <span class="va">gg.add</span> <span class="co">## look to the appendix for the code for this</span></span></code></pre></div>
<p><img src="barrierExample_files/figure-html/uviz-1.png" width="99%" style="display: block; margin: auto;"></p>
<p>The visualization of the simulated process over the barrier allows a
visual inspection of the model property. The process in different sides
of the barriers seen to be independent, as illustrated by the
correlation plots.</p>
</div>
<div class="section level3">
<h3 id="sampling-a-set-of-observations">Sampling a set of observations<a class="anchor" aria-label="anchor" href="#sampling-a-set-of-observations"></a>
</h3>
<p>We define a initial set of locations to consider that we observe the
field at these locations. We start with a set of locations chosen
completely at random in the rectangle domain, including a barrier
part</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n0</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">xy0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n0</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n0</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we check which of these is inside the barrier</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy.b</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">splancs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/splancs/man/inout.html" class="external-link">inout</a></span><span class="op">(</span><span class="va">xy0</span>, <span class="va">barrier1</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span></span>
<span>  <span class="op">(</span><span class="fu">splancs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/splancs/man/inout.html" class="external-link">inout</a></span><span class="op">(</span><span class="va">xy0</span>, <span class="va">barrier2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ii</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">xy.b</span><span class="op">)</span></span></code></pre></div>
<p>The locations to form the data consider only the locations in the
desired domain and outside the barrier</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">xy0</span><span class="op">[</span><span class="va">ii</span>, <span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">xy0</span><span class="op">[</span><span class="va">ii</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 464</span></span></code></pre></div>
<p>To simulate the outcome, we project the field to these locations, add
an intercept and some random noise</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigma.e</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">dataset</span><span class="op">$</span><span class="va">outcome</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>        <span class="va">mesh</span>,</span>
<span>        loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">x</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,</span>
<span>        field <span class="op">=</span> <span class="va">u</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fl">10</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.0</span>, <span class="va">sigma.e</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h2>
<p>Here we illustrate the use of the function in
<strong>INLAspacetime</strong> to implement the barrier model as in
<span class="citation">Bakka et al. (2019)</span>. This implementation
consider the <code>cgeneric</code> computational method that is useful
to implement new models with <strong>INLA</strong>. This method allows
the computations in <strong>INLA</strong> to take full advantage of
parallel computations, achieving shorter computation time than with the
original implementation.</p>
<p>We define the model object with</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/barrierModel.define.html">barrierModel.define</a></span><span class="op">(</span></span>
<span>    mesh <span class="op">=</span> <span class="va">mesh</span>, </span>
<span>    barrier.triangles <span class="op">=</span> <span class="va">triBarrier</span>,</span>
<span>    prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="co">## P(range &lt; 1) = 0.01</span></span>
<span>    prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="co">## P(sigma &gt; 1) = 0.01</span></span>
<span>    range.fraction <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>We use the model formula in the <strong>inlabru</strong> way, where
the <code>field</code> will be the name for the spatial effect:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">outcome</span> <span class="op">~</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">field</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, model <span class="op">=</span> <span class="va">bmodel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Warning in inla.model.properties.generic(inla.trim.family(model), mm[names(mm) == : Model 'cgeneric' in section 'latent' is marked as 'experimental'; changes may appear at any time.</span></span>
<span><span class="co">#&gt;   Use this model with extra care!!! Further warnings are disabled.</span></span></code></pre>
<p>The <strong>inlabru</strong> main function can be supplied with only
the model formula, the data and the family, as follows</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru</a></span><span class="op">(</span></span>
<span>    <span class="va">model</span>, <span class="va">dataset</span>, family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>We can see the summary for the posterior marginal distribution for
the intercept with</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span><span class="op">$</span><span class="va">summary.fix</span></span>
<span><span class="co">#&gt;               mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; Intercept 10.11299 0.4101878   9.306188 10.10424   10.96949 10.10519</span></span>
<span><span class="co">#&gt;                    kld</span></span>
<span><span class="co">#&gt; Intercept 8.663504e-07</span></span></code></pre></div>
<p>For the hyper-parameters the computations were performed in an
internal scale. That is log of range and log(<span class="math inline">\(\sigma\)</span>), and <span class="math inline">\(\log(1/\sigma_e^2)\)</span>. However, we can
transform each of the hyper-parameters from the internal marginal scale
to its scale with</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pmarginals</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>            param <span class="op">=</span> <span class="st">"sigma.e"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                <span class="va">result</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>            param <span class="op">=</span> <span class="st">"range"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>                <span class="va">result</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>            param <span class="op">=</span> <span class="st">"sigma"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>                <span class="va">result</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>From these transformed posterior marginal distributions we can
extract a summary to compare with the values used to sample the
data:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span>true <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>sigma.e <span class="op">=</span> <span class="va">sigma.e</span>, range <span class="op">=</span> <span class="va">ranges</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">pmarginals</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.zmarginal</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         sigma.e    range     sigma</span></span>
<span><span class="co">#&gt; true 1.00000000 4.000000 1.0000000</span></span>
<span><span class="co">#&gt; mean 1.04428634 4.041961 0.9013457</span></span>
<span><span class="co">#&gt; sd   0.03813044 1.078826 0.1393268</span></span></code></pre></div>
<p>We can also visualize these these posterior marginal distributions
with</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">pmarginals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">param</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="barrierExample_files/figure-html/pmargsvis-1.png" width="69%" style="display: block; margin: auto;"></p>
<div class="section level4">
<h4 id="the-fitted-field">The fitted field<a class="anchor" aria-label="anchor" href="#the-fitted-field"></a>
</h4>
<p>We can visualize summaries from the fitted field. The posterior mean
and the standard deviation can be projected into small pixels and added
to the raster data with</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid.df</span><span class="op">$</span><span class="va">u.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>    <span class="va">pgrid</span>,</span>
<span>    <span class="va">result</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">field</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grid.df</span><span class="op">$</span><span class="va">u.sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>    <span class="va">pgrid</span>,</span>
<span>    <span class="va">result</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">field</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To help the visualization, we will filter the grid pixels considering
the barriers.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gInBarrier</span> <span class="op">&lt;-</span> </span>
<span>  <span class="op">(</span><span class="fu">splancs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/splancs/man/inout.html" class="external-link">inout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">grid.df</span><span class="op">$</span><span class="va">x</span>, <span class="va">grid.df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="va">barrier1</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span></span>
<span>  <span class="op">(</span><span class="fu">splancs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/splancs/man/inout.html" class="external-link">inout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">grid.df</span><span class="op">$</span><span class="va">x</span>, <span class="va">grid.df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="va">barrier2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now visualize the posterior mean with</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg0</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">grid.df</span><span class="op">[</span><span class="op">!</span><span class="va">gInBarrier</span>, <span class="op">]</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">u.mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">gg.add</span> <span class="co">## look to the appendix for the code for this</span></span></code></pre></div>
<p><img src="barrierExample_files/figure-html/umeanviz-1.png" width="99%" style="display: block; margin: auto;"></p>
<p>The estimated field, considering the posterior mean shown, exhibits a
different pattern in each side of the barrier, particularly far from its
tip. Therefore we successfully accounted for the barrier in the model.
See <a href="https://haakonbakkagit.github.io/btopic128.html" class="external-link">this
tutorial</a> for details and how to visualize the implied correlation
between two points.</p>
<p>Similarly, we can plot the posterior standard deviation of the field,
and the data locations used to estimate the model. This has lower values
around more densely sampled locations and higher values otherwise. The
highest are near the boundaries, including the boundary at the barriers,
and far from observed locations.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg0</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">grid.df</span><span class="op">[</span><span class="op">!</span><span class="va">gInBarrier</span>, <span class="op">]</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">u.sd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">gg.add</span> <span class="co">## look to the appendix for the code for this</span></span></code></pre></div>
<p><img src="barrierExample_files/figure-html/usdviz-1.png" width="99%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="appendix-a-adapting-old-code">Appendix A: adapting old code<a class="anchor" aria-label="anchor" href="#appendix-a-adapting-old-code"></a>
</h2>
<p>To adapt code based in <a href="https://haakonbakkagit.github.io/btopic128.html" class="external-link">this
tutorial</a>, one should consider that there are two new functions
implemented, as detailed bellow:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Old</th>
<th align="left">New</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">inla.barrier.fem()</td>
<td align="left">mesh2fem.barrier()</td>
</tr>
<tr class="even">
<td align="left">inla.barrier.pcmatern()</td>
<td align="left">barrierModel.define()</td>
</tr>
</tbody>
</table>
<p>The arguments in the new functions have the same names as in the old
ones. The new function used to define the model has additional
arguments. See the help of this function for details.</p>
</div>
<div class="section level2">
<h2 id="appendix-b-ggplot-reused-code">Appendix B: ggplot reused code<a class="anchor" aria-label="anchor" href="#appendix-b-ggplot-reused-code"></a>
</h2>
<p>The additional <strong>ggplot2</strong> code used</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg.add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"div"</span>, </span>
<span>    palette <span class="op">=</span> <span class="st">"RdBu"</span>, </span>
<span>    na.value <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">add.b0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, </span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">barrier1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, </span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">barrier1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span>, colour <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">gray</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, <span class="co">##"transparent"),</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, </span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">barrier2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, </span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">barrier2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> </span>
<span>    <span class="op">)</span>, colour <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">gray</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="co">##"transparent")</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bakka2019barrier" class="csl-entry">
Bakka, H., J. Vanhatalo, J. Illian, D. Simpson, and H. Rue. 2019.
<span>“Non-Stationary Gaussian Models with Physical Barriers.”</span>
<em>Spatial Statistics</em> 29 (March): 268–88. https://doi.org/<a href="https://doi.org/10.1016/j.spasta.2019.01.002" class="external-link">https://doi.org/10.1016/j.spasta.2019.01.002</a>.
</div>
<div id="ref-lindgren2011explicit" class="csl-entry">
Lindgren, Finn, Håvard Rue, and Johan Lindström. 2011. <span>“An
Explicit Link Between <span>Gaussian</span> Fields and
<span>Gaussian</span> <span>Markov</span> Random Fields: The Stochastic
Partial Differential Equation Approach.”</span> <em>Journal of the Royal
Statistical Society: Series B (Statistical Methodology)</em> 73 (4):
423–98. <a href="https://doi.org/10.1111/j.1467-9868.2011.00777.x" class="external-link">https://doi.org/10.1111/j.1467-9868.2011.00777.x</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Elias Teixeira Krainski, Finn Lindgren, Haavard Rue.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
