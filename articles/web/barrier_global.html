<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Global oceanic barrier model on the sphere • INLAspacetime</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Global oceanic barrier model on the sphere">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">INLAspacetime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.12.013</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../../articles/web/barrierExample.html">Spatial models for domains with barrier</a></li>
    <li><a class="dropdown-item" href="../../articles/web/piemonte.html">Spatio-temporal examples</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eliaskrainski/INLAspacetime/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Global oceanic barrier model on the sphere</h1>
                        <h4 data-toc-skip class="author">Alba
Fuster-Alonso<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="mailto:afuster@icm.csic.es" class="email"&gt;afuster@icm.csic.es&lt;/a&gt;, Institut de Ciències del Mar
(ICM) - CSIC, Barcelona, Spain.&lt;/p&gt;'><sup>1</sup></a>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mspace width="0.278em"></mspace><annotation encoding="application/x-tex">\;</annotation></semantics></math>
Elias T Krainski<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;King Abdullah University of Science and Technology
(KAUST), Thuwal, Saudi Arabia.&lt;/p&gt;"><sup>2</sup></a>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mspace width="0.278em"></mspace><annotation encoding="application/x-tex">\;</annotation></semantics></math>
Haavard Rue<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;King Abdullah University of Science and Technology
(KAUST), Thuwal, Saudi Arabia.&lt;/p&gt;"><sup>3</sup></a>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mspace width="0.278em"></mspace><annotation encoding="application/x-tex">\;</annotation></semantics></math>
Finn Lindgren<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;University of Edinburgh (UoE), Edinburgh, Scotland.&lt;/p&gt;"><sup>4</sup></a>
</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/eliaskrainski/INLAspacetime/blob/master/vignettes/web/barrier_global.Rmd" class="external-link"><code>vignettes/web/barrier_global.Rmd</code></a></small>
      <div class="d-none name"><code>barrier_global.Rmd</code></div>
    </div>

    
    
<style> body {text-align: justify} </style>
<!-- Justify text. --><div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this tutorial, we illustrate the implementation of the barrier
model proposed in Bakka et al. (2019) in the sphere. It considers the
problem of modeling over a spatial domain, taking into account physical
barriers and the spherical shape of the Earth. Since we are working on
the global oceans, continents can be considered as physical barriers,
and this aspect has to be taken into account in the modeling. When using
a barrier model, the range is not only determined by the distance to
points. If there is a barrier between two points, the range should
decrease quickly, and the correlation over the barrier should approach
zero. Additionally, the Earth’s spherical shape is a crucial factor in
this particular case, as considering a planar approximation can bias the
results when working on a global scale. Therefore, this tutorial is
developed using a projection onto a sphere. We are using the new
implementation of the INLA package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eliaskrainski/INLAspacetime" class="external-link">INLAspacetime</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mikkovihtakari.github.io/ggOceanMaps/" class="external-link">ggOceanMaps</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/s2/" class="external-link">s2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jmestret/DOYPAColors" class="external-link">DOYPAColors</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="tabset" id="define-barriers">Define barriers<a class="anchor" aria-label="anchor" href="#define-barriers"></a>
</h2>
<p>Our initial step is to define the barriers in the model. As we aim to
model an oceanic variable, it is essential to treat all continents as
barriers. To accomplish this, we must establish specific parameters,
including the mesh resolution, maximum edge length of the mesh, and
define a distance and a buffer to simplify certain country polygons. If
we increase the mesh resolution, the computational time will also
increase.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Mesh resolution (bigger number increases the resolution)</span></span>
<span><span class="va">sresol</span> <span class="op">&lt;-</span> <span class="fl">30</span> </span>
<span></span>
<span><span class="co">## This resolution will gives the approximate maximum edge length (in km) </span></span>
<span><span class="va">max_edge</span> <span class="op">&lt;-</span> <span class="fl">36080.2</span> <span class="op">*</span> <span class="fl">0.2</span> <span class="op">/</span> <span class="va">sresol</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/units.html" class="external-link">units</a></span><span class="op">(</span><span class="va">max_edge</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"km"</span></span>
<span></span>
<span><span class="co">## Set a minimum distance to be used for simplification of polygons</span></span>
<span><span class="va">dist_simplify</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/units.html" class="external-link">units</a></span><span class="op">(</span><span class="va">dist_simplify</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"km"</span></span>
<span></span>
<span><span class="co">## Set a buffer distance to be added to certain polygons </span></span>
<span><span class="va">bufferdist</span> <span class="op">&lt;-</span> <span class="va">max_edge</span> <span class="op">/</span> <span class="fl">2</span></span></code></pre></div>
<p>Subsequently, we use the <strong>ne_countries</strong> function from
the rnaturalearth package to download data for all countries, employing
the Mollweide projection. We specify that we want an object class of
Simple Features (sf) for ease in conducting spatial operations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Download country boundaries data at a medium scale</span></span>
<span><span class="va">world_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"medium"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Retrieve the coordinate reference system (CRS) of the downloaded data</span></span>
<span><span class="va">crs_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">world_ll</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Define Mollweide projection </span></span>
<span><span class="va">crs_vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="st">"+proj=moll +units=km +units=km"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Transform the country boundaries data to the Mollweide projection</span></span>
<span><span class="va">world_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">world_ll</span><span class="op">)</span>, <span class="va">crs_vis</span><span class="op">)</span></span></code></pre></div>
<p>We now create a function to define a bounding box around the earth in
the latlong projection. This will be used later.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## function to create a Earth polygon</span></span>
<span><span class="va">Earth_poly</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">resol</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_multipolygon</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>            long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">resol</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">resol</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">resol</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="va">resol</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>            <span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">180</span> <span class="op">-</span> <span class="fl">1e-5</span><span class="op">)</span>,</span>
<span>            lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">resol</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">resol</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="va">resol</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">resol</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>            <span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">90</span> <span class="op">-</span> <span class="fl">1e-5</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We also need to prepare a grid for projecting the effects of the
model, considering the Mollweide projection and the spherical shape of
the Earth. To accomplish this, we have implemented a function called
<strong>grid_create</strong>. This function creates a grid of points
within a specified boundary that do not intersect with a given barrier.
The barrier can be either a Simple Features (sf) or Simple Features
Collection (sfc) object representing a geographic region, and the
boundary can be specified by either providing a boundary object or
numeric limits for x and y axes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Function to create the grid for projection while considering the barrier</span></span>
<span><span class="va">grid_create</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">barrier</span>, <span class="va">resol</span> <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">barrier</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sf"</span>, <span class="st">"sfc"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"barrier must be sf or sfc objects."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">Ell</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/Earth_poly.html">Earth_poly</a></span><span class="op">(</span>resol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">Ell</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">barrier</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Ell_transformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">Ell</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">barrier</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">Ell_transformed</span> <span class="op">&lt;-</span> <span class="va">Ell</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">grid_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">Ell_transformed</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                        to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">Ell_transformed</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                        by <span class="op">=</span> <span class="va">resol</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">Ell_transformed</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                        to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">Ell_transformed</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                        by <span class="op">=</span> <span class="va">resol</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    coords <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">barrier</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ig_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="va">grid_0</span>, <span class="va">Ell_transformed</span><span class="op">)</span>, <span class="va">length</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">ig_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">ig_0</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span><span class="va">grid_0</span>, <span class="va">barrier</span><span class="op">)</span>, <span class="va">length</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">grid_mll</span> <span class="op">&lt;-</span> <span class="va">grid_0</span><span class="op">[</span><span class="va">ig_sel</span>, <span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">grid_mll</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Grid in Mollweide </span></span>
<span><span class="va">mgrid</span> <span class="op">&lt;-</span> <span class="fu">grid_create</span><span class="op">(</span>barrier <span class="op">=</span> <span class="va">world_mll</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Grid in latlong </span></span>
<span><span class="va">grid_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mgrid</span>, crs <span class="op">=</span> <span class="va">crs_ll</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Transform to the sphere </span></span>
<span><span class="va">mgrid_sph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_transform.html" class="external-link">fm_transform</a></span><span class="op">(</span></span>
<span>    <span class="va">mgrid</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="st">"sphere"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>At this point, we will modify some of the barrier polygons to enhance
realism and facilitate computation. First, we will calculate the area of
each polygon downloaded earlier and if they are isolated or not. This is
to identify small and isolated islands that may not be relevant to our
model, and we should exclude them from the barrier.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Compute the area of each polygon</span></span>
<span><span class="va">world_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">world_mll</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract the neighbor list from this map (consider neighbor if any coordinate within the buffer distance)</span></span>
<span><span class="va">nb</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">:::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">poly2nb</a></span><span class="op">(</span></span>
<span>                pl <span class="op">=</span> <span class="va">world_mll</span>,</span>
<span>                snap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bufferdist</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Number of neighbors</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/card.html" class="external-link">card</a></span><span class="op">(</span><span class="va">nb</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Identify small multipolygons (area smaller than square of the approximated maximum length of the edges in the modeling domain)</span></span>
<span><span class="va">wpolyclass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">world_area</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">max_edge</span>, <span class="st">"big"</span>, <span class="st">"small"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">nn</span><span class="op">&gt;</span><span class="fl">0</span>, <span class="st">"connected"</span>, <span class="st">"isolated"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Moreover, we will give the option for expanding some straits, such as
the Suez Canal or the Strait of Gibraltar to minimize correlation near
the borders.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Enlarge Suez canal</span></span>
<span><span class="co">## Define the coordinates for the Suez canal polygon</span></span>
<span><span class="va">suez_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31.6</span>, <span class="fl">31.7</span>, <span class="fl">43.9</span>, <span class="fl">43.8</span>, <span class="fl">31.6</span>,</span>
<span>      <span class="fl">31.5</span>, <span class="fl">31.7</span>, <span class="fl">12.0</span>, <span class="fl">11.8</span>, <span class="fl">31.5</span><span class="op">)</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create a Simple Features (sf) polygon for the Suez canal</span></span>
<span><span class="va">suez_ll</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">suez_ll</span><span class="op">)</span></span>
<span>    <span class="op">)</span>, crs <span class="op">=</span> <span class="va">crs_ll</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Transform the Suez canal polygon and create a buffer</span></span>
<span><span class="va">suez_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">suez_ll</span>, <span class="va">crs_vis</span><span class="op">)</span>,</span>
<span>    dist <span class="op">=</span> <span class="va">bufferdist</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Enlarge strait of Gibraltar </span></span>
<span><span class="co">## Define the coordinates for the Strait of Gibraltar polygon</span></span>
<span><span class="va">gibra_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6.0</span>, <span class="op">-</span><span class="fl">5.2</span>, <span class="op">-</span><span class="fl">5.2</span>, <span class="op">-</span><span class="fl">6.0</span>, <span class="op">-</span><span class="fl">6.0</span>,</span>
<span>      <span class="fl">36.0</span>, <span class="fl">36.0</span>, <span class="fl">35.9</span>, <span class="fl">35.9</span>, <span class="fl">36.0</span><span class="op">)</span>, </span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create a Simple Features (sf) polygon for the Strait of Gibraltar</span></span>
<span><span class="va">gibra_ll</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gibra_ll</span><span class="op">)</span></span>
<span>    <span class="op">)</span>, crs <span class="op">=</span> <span class="va">crs_ll</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Transform the Strait of Gibraltar polygon and create a buffer</span></span>
<span><span class="va">gibra_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">gibra_ll</span>, <span class="va">crs_vis</span><span class="op">)</span>,</span>
<span>    dist <span class="op">=</span> <span class="va">bufferdist</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Enlarge Turkish straits </span></span>
<span><span class="co">## Define the coordinates for the Turkish straits polygon</span></span>
<span><span class="va">turk_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">26.1</span>, <span class="fl">39.95</span>,</span>
<span>    <span class="fl">29.35</span>, <span class="fl">41.15</span>,</span>
<span>    <span class="fl">29.3</span>, <span class="fl">41.35</span>,</span>
<span>    <span class="fl">26.05</span>, <span class="fl">40.15</span>,</span>
<span>    <span class="fl">26.1</span>, <span class="fl">39.95</span><span class="op">)</span>,  </span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create a Simple Features (sf) polygon for the  Turkish straits</span></span>
<span><span class="va">turk_ll</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">turk_ll</span><span class="op">)</span></span>
<span>    <span class="op">)</span>, crs <span class="op">=</span> <span class="va">crs_ll</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Transform the Turkish straits polygon and create a buffer</span></span>
<span><span class="va">turk_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">turk_ll</span>, <span class="va">crs_vis</span><span class="op">)</span>,</span>
<span>    dist <span class="op">=</span> <span class="va">bufferdist</span><span class="op">/</span><span class="fl">6</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After identifying the area and isolation of the polygons, we will
remove those polygons from the barrier that are considered isolated and
small.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Remove small and isolated polygons</span></span>
<span><span class="va">world_barrier_initial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_difference</a></span><span class="op">(</span></span>
<span>    <span class="va">world_mll</span><span class="op">[</span><span class="va">wpolyclass</span> <span class="op">!=</span> <span class="st">"small isolated"</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">suez_mll</span>, <span class="va">gibra_mll</span>, <span class="va">turk_mll</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>Likewise, we plan to incorporate buffers around specific regions of
the world. For example, we want to account for the closure of the Panama
Canal, consider the ice cover of Antarctica, and include a buffer around
the Gulf of Ob to facilitate the simulation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Panama country polygon retrieval and buffer creation</span></span>
<span><span class="va">panm_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"panama"</span>, scale <span class="op">=</span> <span class="st">"medium"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span><span class="va">panm_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">panm_ll</span><span class="op">)</span>, <span class="va">crs_vis</span><span class="op">)</span>,</span>
<span>    dist <span class="op">=</span> <span class="va">bufferdist</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Define the coordinates for the Gulf of Ob polygon</span></span>
<span><span class="va">gulf_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70</span>, <span class="fl">78</span>, <span class="fl">78</span>, <span class="fl">70</span>, <span class="fl">70</span>,</span>
<span>    <span class="fl">65</span>, <span class="fl">65</span>, <span class="fl">73</span>, <span class="fl">73</span>, <span class="fl">65</span><span class="op">)</span>, </span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create a Simple Features (sf) polygon for the Gulf of Ob</span></span>
<span><span class="va">gulf_ll</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gulf_ll</span><span class="op">)</span></span>
<span>  <span class="op">)</span>, crs <span class="op">=</span> <span class="va">crs_ll</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Transform the Gulf of Ob polygon and create a buffer </span></span>
<span><span class="va">gulf_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">gulf_ll</span>, <span class="va">crs_vis</span><span class="op">)</span>,</span>
<span>  dist <span class="op">=</span> <span class="va">bufferdist</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Download Antarctica polygon</span></span>
<span><span class="va">antar_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"Antarctica"</span>, scale <span class="op">=</span> <span class="st">"medium"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Include a buffer </span></span>
<span><span class="va">antar_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">antar_ll</span><span class="op">)</span>, <span class="va">crs_vis</span><span class="op">)</span>,</span>
<span>  dist <span class="op">=</span> <span class="va">bufferdist</span><span class="op">)</span></span></code></pre></div>
<p>Once the specific polygons have been modified, we can proceed to
integrate them with our multipolygon of world countries. We also use the
<em>st_simplify</em> function to simplify the borders of the polygons
while preserving the topology of the domain.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Buffer world land</span></span>
<span><span class="va">world_lnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">world_barrier_initial</span>, <span class="va">panm_mll</span>, <span class="va">gulf_mll</span>, <span class="va">antar_mll</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## World land excluding the Suez canal, Turkish straits, and Gibraltar strait </span></span>
<span><span class="va">world_dff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_difference</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">world_lnd</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">suez_mll</span>, <span class="va">gibra_mll</span>, <span class="va">turk_mll</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## World land without modifications for visualization</span></span>
<span><span class="va">world_union</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">world_mll</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Join and simplify the boundary of the barrier domain so that very detailed parts would be smoothed out</span></span>
<span><span class="va">world_barrier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_simplify</a></span><span class="op">(</span></span>
<span>    <span class="va">world_dff</span>, </span>
<span>    preserveTopology <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    dTolerance <span class="op">=</span> <span class="va">dist_simplify</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="classifying-polygon-areas">Classifying polygon areas<a class="anchor" aria-label="anchor" href="#classifying-polygon-areas"></a>
</h3>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizeworld-1.png" class="r-plt" alt="Classify polygons based on size, where TRUE indicates a large polygon, and FALSE indicates a small polygon." width="700"><p class="caption">
Classify polygons based on size, where TRUE indicates a large polygon,
and FALSE indicates a small polygon.
</p>
</div>
</div>
<div class="section level3">
<h3 id="classifying-polygon-loneliness">Classifying polygon loneliness<a class="anchor" aria-label="anchor" href="#classifying-polygon-loneliness"></a>
</h3>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualisepolyclass-1.png" class="r-plt" alt="Classify polygons based on size and connectivity, so that a polygon can be categorized as either big or small and connected or isolated." width="700"><p class="caption">
Classify polygons based on size and connectivity, so that a polygon can
be categorized as either big or small and connected or isolated.
</p>
</div>
</div>
<div class="section level3">
<h3 id="buffers-and-straits">Buffers and straits<a class="anchor" aria-label="anchor" href="#buffers-and-straits"></a>
</h3>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizemaps-1.png" class="r-plt" alt="Modifications were implemented on the globe to generate the barrier model." width="700"><p class="caption">
Modifications were implemented on the globe to generate the barrier
model.
</p>
</div>
</div>
<div class="section level3">
<h3 id="barrier-polygons">Barrier polygons<a class="anchor" aria-label="anchor" href="#barrier-polygons"></a>
</h3>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizebarrier-1.png" class="r-plt" alt="Barrier polygons after filtering small isolated polygons and specifying modifications to open and close certain areas." width="700"><p class="caption">
Barrier polygons after filtering small isolated polygons and specifying
modifications to open and close certain areas.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="mesh-creation">Mesh Creation<a class="anchor" aria-label="anchor" href="#mesh-creation"></a>
</h2>
<p>The barrier model proposed by Bakka et al. (2019), involves a
triangulation method. Therefore, we are going to consider an underlying
random field over the whole sphere; and this random field will be
discretized using the mesh, defining a precision matrix for the
distribution at the mesh nodes. In order to work more efficiently, we
will simulate higher-resolution points outside the barrier using the
<strong>fmesher_globe_points</strong> function. This allows us to
utilize these initial points to reduce the number of nodes inside the
barrier. Consequently, this will improve computation speed without
compromising the results of the model. It’s crucial to note that the
mesh is designed with consideration for a sphere
(<strong>fm_transform</strong>), allowing us to work in three
dimensions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a initial set of points over the globe considering the desired resolution</span></span>
<span><span class="va">reg.glob.pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fmesher_globe_points.html" class="external-link">fmesher_globe_points</a></span><span class="op">(</span></span>
<span>    globe <span class="op">=</span> <span class="va">sresol</span> <span class="co">## subdivision resolution for a semi-regular spherical triangulation with equidistant points along equidistant latitude bands</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Project it to the working projection (sphere)</span></span>
<span><span class="va">inipts0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_transform.html" class="external-link">fm_transform</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">reg.glob.pts</span><span class="op">)</span>,</span>
<span>             coords <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>             crs <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="st">"sphere"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="va">world_barrier</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Verify which of these points are inside an extended model domain</span></span>
<span><span class="va">in_ocean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span></span>
<span>    <span class="va">inipts0</span>,</span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">world_lnd</span><span class="op">)</span>, dist <span class="op">=</span> <span class="op">-</span> <span class="va">bufferdist</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span>, <span class="va">length</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>After the definition of the points and the projection, we can
generate the mesh and examine the number of nodes it contains. For this
particular scenario, the mesh comprises a total of 7068 nodes. To
achieve this, we utilize the <strong>fm_rcdt_2d function</strong>,
specifying the <em>globe</em> argument with the desired resolution, the
<em>crs</em> for the sphere, <em>loc</em> for the high-resolution points
previously created, and the <em>cutoff</em> to avoid tiny triangles.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a triangular mesh on the globe with a specified resolution</span></span>
<span><span class="va">smesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_rcdt_2d.html" class="external-link">fm_rcdt_2d_inla</a></span><span class="op">(</span></span>
<span>    loc <span class="op">=</span> <span class="va">reg.glob.pts</span><span class="op">[</span><span class="va">in_ocean</span>, <span class="op">]</span>, <span class="co">## use the initial points</span></span>
<span>    globe <span class="op">=</span> <span class="fl">10</span>, <span class="co">## we use lower resolution for the rest (barrier) of the domain</span></span>
<span>    cutoff <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">sresol</span>, <span class="co">## to avoid tiny triangles</span></span>
<span>    crs <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="st">"sphere"</span><span class="op">)</span> <span class="co">## the 'CRS' for the mesh over the sphere</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Number of nodes</span></span>
<span><span class="va">smesh</span><span class="op">$</span><span class="va">n</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] 6978</span></span></code></pre>
<p>Now, we can perform operations on that mesh using different map
projections. We are interested in utilizing the Mollweide projection for
plotting the mesh. To achieve this, we employ the
<strong>fm_transform</strong> function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Collect the mesh locations and directly transform it to the Mollweide projection</span></span>
<span><span class="va">lmesh_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_transform.html" class="external-link">fm_transform</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">smesh</span><span class="op">$</span><span class="va">loc</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>             crs <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="va">smesh</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    crs <span class="op">=</span> <span class="va">crs_vis</span><span class="op">)</span></span></code></pre></div>
<p>Since we are working with a barrier model, we need to identify the
mesh nodes that are inside the barriers. For that, we will use the
function <strong>fm_contains</strong>, which finds triangle centroids or
vertices inside sf or sp polygon objects.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract triangles containing barriers</span></span>
<span><span class="va">triBarrier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_contains.html" class="external-link">fm_contains</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">world_barrier</span>, <span class="co">## Barrier polygons</span></span>
<span>  y <span class="op">=</span> <span class="va">smesh</span>, <span class="co">## Mesh </span></span>
<span>  type <span class="op">=</span> <span class="st">"centroid"</span> </span>
<span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="section level3">
<h3 id="initial-points">Initial points<a class="anchor" aria-label="anchor" href="#initial-points"></a>
</h3>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizeBpoints-1.png" class="r-plt" alt="Generation of initial points for the mesh throughout the domain." width="700"><p class="caption">
Generation of initial points for the mesh throughout the domain.
</p>
</div>
</div>
<div class="section level3">
<h3 id="mesh-with-barriers">Mesh with barriers<a class="anchor" aria-label="anchor" href="#mesh-with-barriers"></a>
</h3>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/triCenters-1.png" class="r-plt" alt="Representation of mesh nodes on the sphere: nodes inside a barrier are black, while those outside are blue." width="700"><p class="caption">
Representation of mesh nodes on the sphere: nodes inside a barrier are
black, while those outside are blue.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="correlation-values-at-specific-points">Correlation values at specific points<a class="anchor" aria-label="anchor" href="#correlation-values-at-specific-points"></a>
</h2>
<p>We can utilize the discretized model to calculate correlations
between pairs of points to assess the model properties before
simulation. Initially, it is essential to define the key parameters of
the barrier model, aligning with an SPDE model: the practical range and
the marginal variance (Lindgren et al. 2011). The barrier’s range is
determined as a fraction of the range across the entire domain.
Specifically, we set a range of 0.63, corresponding to 4000 km. In
proximity to a barrier, we use 0.008 of the value of the range.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a barrier model using the mesh </span></span>
<span><span class="va">bfem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mesh2fem.html">mesh2fem.barrier</a></span><span class="op">(</span><span class="va">smesh</span>, <span class="va">triBarrier</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Set parameters for barrier field simulation</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co">## standard deviation </span></span>
<span><span class="va">ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4000</span>, <span class="fl">50</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu">s2</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/s2/reference/s2_earth_radius_meters.html" class="external-link">s2_earth_radius_meters</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fl">1e3</span><span class="op">)</span> <span class="co">## practical range: 4000km</span></span>
<span></span>
<span><span class="co">## Create a precision matrix with the specified parameters</span></span>
<span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.barrier.html" class="external-link">inla.barrier.q</a></span><span class="op">(</span><span class="va">bfem</span>, ranges <span class="op">=</span> <span class="va">ranges</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></code></pre></div>
<p>Then, we need to use the already defined function
<em>localCorrel2D</em> in the tutorial “A Barrier Model Illustration”
(<a href="https://github.com/eliaskrainski/INLAspacetime" class="external-link uri">https://github.com/eliaskrainski/INLAspacetime</a>), to
compute the correlation from a given set of locations to each mesh node
location (with minor changes in the function).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define a function for calculating local correlations</span></span>
<span><span class="va">localCorrel2D</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">locs</span>, <span class="va">mesh.locs</span>, <span class="va">Q</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">locs</span><span class="op">)</span>  <span class="co">## Number of locations</span></span>
<span></span>
<span>    <span class="va">ii</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nl</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/s2/reference/s2_is_collection.html" class="external-link">s2_distance</a></span><span class="op">(</span></span>
<span>            <span class="va">mesh.locs</span>, <span class="va">locs</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>,</span>
<span>            radius <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/s2/reference/s2_earth_radius_meters.html" class="external-link">s2_earth_radius_meters</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span>  <span class="co">## Indices of the closest locations on the mesh</span></span>
<span></span>
<span>    </span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span>, <span class="va">nl</span><span class="op">)</span>  <span class="co">## Initialize a matrix of zeros</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span></span>
<span>        <span class="va">b</span><span class="op">[</span><span class="va">ii</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co">## Set 1 at positions corresponding to the closest locations</span></span>
<span>    </span>
<span>    <span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/qsolve.html" class="external-link">inla.qsolve</a></span><span class="op">(</span><span class="va">Q</span>, <span class="va">b</span><span class="op">)</span>  <span class="co">## Solve the linear system Q * cc = b</span></span>
<span>    <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/qinv.html" class="external-link">inla.qinv</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co">## Calculate the square root of the diagonal of the inverse of Q</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span></span>
<span>        <span class="va">cc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="va">s</span> <span class="op">*</span> <span class="va">s</span><span class="op">[</span><span class="va">ii</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>  <span class="co">## Normalize local correlations</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span><span class="op">)</span>  <span class="co">## Return normalized local correlations</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We start by selecting various locations and transform them into
Mollweide coordinates. We have chosen locations that are close to
barriers or between barriers, so it’s easy to verify if the model is
working properly. We should observe a decrease around the barrier. We
will also convert the mesh into latitude and longitude coordinates,
allowing us to work with a 2D representation of the mesh.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Locations for correlation calculation</span></span>
<span><span class="va">locs_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fl">60</span>, <span class="fl">70</span>,</span>
<span>    <span class="op">-</span><span class="fl">90</span>, <span class="fl">10</span>, </span>
<span>    <span class="fl">25</span>, <span class="fl">34</span>,</span>
<span>    <span class="fl">122</span>,  <span class="fl">4</span>,</span>
<span>    <span class="fl">40</span>, <span class="op">-</span><span class="fl">20</span>,</span>
<span>    <span class="fl">175</span>, <span class="op">-</span><span class="fl">45</span></span>
<span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create spatial points for visualization</span></span>
<span><span class="va">locs_latlong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">locs_ll</span><span class="op">)</span>,</span>
<span>    coords <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, crs <span class="op">=</span> <span class="va">crs_ll</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Mesh nodes in longlat projection</span></span>
<span><span class="va">mesh_locs_ll</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span> <span class="co">## Convert foreign object to an sf object</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.map.html" class="external-link">inla.mesh.map</a></span><span class="op">(</span><span class="va">smesh</span><span class="op">$</span><span class="va">loc</span>, <span class="co">## Calculates coordinate for inla.mesh projection</span></span>
<span>                  projection <span class="op">=</span> <span class="st">"longlat"</span>, <span class="co">## the projection type</span></span>
<span>                  inverse <span class="op">=</span> <span class="cn">FALSE</span> <span class="co">## means that locations (loc) are coordinates in the mesh domain</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"+proj=longlat +ellps=WGS84"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Locations for computing correlations.</caption>
<thead><tr class="header">
<th align="right">x coordinates</th>
<th align="right">y coordinates</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-60</td>
<td align="right">70</td>
</tr>
<tr class="even">
<td align="right">-90</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">34</td>
</tr>
<tr class="even">
<td align="right">122</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">40</td>
<td align="right">-20</td>
</tr>
<tr class="even">
<td align="right">175</td>
<td align="right">-45</td>
</tr>
</tbody>
</table>
<p>Then, we use the function previously defined,
<strong>localCorrel2D</strong>, to compute the correlation. Since our
function works in a 2D dimension we need to use the mesh into the
latitude and longitude projection (<em>mesh_locs_ll</em>) previously
define, so we can work the correlation on the planar.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate local correlations</span></span>
<span><span class="va">mcorrels</span> <span class="op">&lt;-</span> <span class="fu">localCorrel2D</span><span class="op">(</span></span>
<span>    <span class="va">locs_latlong</span>, <span class="co">## locations</span></span>
<span>    <span class="va">mesh_locs_ll</span>, <span class="co">## mesh projected</span></span>
<span>    <span class="va">Q</span> <span class="co">## precision matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The correlation can be projected and visualized “everywhere”.
However, it is essential to transform the grid coordinates onto the
sphere initially, considering the mesh has been projected in three
dimensions. Once we have the <em>gproj</em> in spherical coordinates, we
can further transform them into kilometer coordinates using the
Mollweide projection for visualization.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a grid projector using the mesh and spherical grid</span></span>
<span><span class="va">gproj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.projector</a></span><span class="op">(</span>mesh <span class="op">=</span> <span class="va">smesh</span>, loc <span class="op">=</span> <span class="va">mgrid_sph</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Project local correlations to the grid</span></span>
<span><span class="va">gcorrels</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>  <span class="va">gproj</span>, field <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0.5</span> <span class="op">-</span><span class="fl">1e-9</span><span class="op">)</span> <span class="op">*</span> <span class="va">mcorrels</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create a data frame for correlation visualization</span></span>
<span><span class="va">mgrid_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">mgrid</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">## Combine data for ggplot</span></span>
<span><span class="va">ggcorrels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span></span>
<span>  <span class="va">rbind</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">locs_ll</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>          <span class="va">mgrid_cor</span>, </span>
<span>          loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>              <span class="st">"l"</span>, <span class="va">l</span>, <span class="st">": ("</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.1f"</span>, <span class="va">locs_ll</span><span class="op">[</span><span class="va">l</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">", "</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.1f"</span>, <span class="va">locs_ll</span><span class="op">[</span><span class="va">l</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>, </span>
<span>          correlation <span class="op">=</span> <span class="va">gcorrels</span><span class="op">[</span>, <span class="va">l</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizecorr-1.png" class="r-plt" alt="Correlation value for the 2 selected spatial points" width="700"><p class="caption">
Correlation value for the 2 selected spatial points
</p>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="simulation-of-the-space-time-barrier-model">Simulation of the space-time barrier model<a class="anchor" aria-label="anchor" href="#simulation-of-the-space-time-barrier-model"></a>
</h2>
<p>Having established the parameters (range and standard deviation) in
the previous section and verified their properties, we can proceed to
compute the simulated random field for the barrier model. Subsequently,
we can project the random field onto the defined grid for visualization.
Since we are working in space and time, we have simulated a total of 6
random fields.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Number of years k </span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span></span>
<span><span class="co">## Initialize lists to store random seeds and spatial fields</span></span>
<span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">345</span>,<span class="fl">1</span>,<span class="fl">123</span>,<span class="fl">663</span>,<span class="fl">2314</span>,<span class="fl">654</span><span class="op">)</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate random samples for each spatial field</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">u</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/qsample.html" class="external-link">inla.qsample</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">Q</span>, seed <span class="op">=</span> <span class="va">seed</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Project the field grid onto the Mollweide projection</span></span>
<span><span class="va">grid_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">grid_sf</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">mgrid</span><span class="op">)</span>,</span>
<span>    u_proj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span><span class="va">gproj</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">u</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    coords <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, crs <span class="op">=</span> <span class="va">crs_vis</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then, to ensure they are not independent from each other, we are
going to correlate them using an autoregressive model of order 1
(AR1).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Autoregressive smoothing</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">0.98</span></span>
<span><span class="va">u_time</span> <span class="op">&lt;-</span> <span class="va">u</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">u_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rho</span> <span class="op">*</span> <span class="va">u_time</span><span class="op">[[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">rho</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">u_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Project the field grid onto the Mollweide projection</span></span>
<span><span class="va">grid_sf_u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">grid_sf_u</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">mgrid</span><span class="op">)</span>,</span>
<span>    u_proj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span><span class="va">gproj</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">u_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    coords <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, crs <span class="op">=</span> <span class="va">crs_vis</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="simulated-random-fields-independent-space-time-effect">Simulated random fields (independent space-time effect)<a class="anchor" aria-label="anchor" href="#simulated-random-fields-independent-space-time-effect"></a>
</h3>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizes-1.png" class="r-plt" alt="Simulated spatial random fields. Each random field is independent of each other." width="700"><p class="caption">
Simulated spatial random fields. Each random field is independent of
each other.
</p>
</div>
</div>
<div class="section level3">
<h3 id="simulated-random-fields-dependent-space-time-effect">Simulated random fields (dependent space-time effect)<a class="anchor" aria-label="anchor" href="#simulated-random-fields-dependent-space-time-effect"></a>
</h3>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizest-1.png" class="r-plt" alt="Simulated spatial random fields, including an autoregressive model of order 1." width="700"><p class="caption">
Simulated spatial random fields, including an autoregressive model of
order 1.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="simulation-of-locations">Simulation of locations<a class="anchor" aria-label="anchor" href="#simulation-of-locations"></a>
</h2>
<p>Regarding the simulation of the response variable, we first need to
determine a set of locations where our variable will be observed. To
achieve this, we simulate <em>n</em> values from a polygon within the
limits of our domain, and the observations will vary for each time. Note
that the simulation of locations takes into account a coordinate
reference system (CRS). Without a CRS, there would be a
disproportionately large number of points near the poles compared to the
equator. This discrepancy arises due to the Earth’s shape, and utilizing
a CRS helps maintain a more balanced and accurate representation in our
simulations.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate random data locations in longlat</span></span>
<span><span class="co">## Create world-size sampling area without crs</span></span>
<span><span class="va">world_poly_wgs84</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/Earth_poly.html">Earth_poly</a></span><span class="op">(</span>resol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add WGS84 crs to a duplicated object</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">world_poly_wgs84</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">4326</span></span>
<span></span>
<span><span class="co">## convert to the Mollweid projection</span></span>
<span><span class="va">world_poly_planar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">world_poly_wgs84</span>, </span>
<span>  crs <span class="op">=</span> <span class="va">crs_vis</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Sample the locations for each time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">34521</span><span class="op">)</span></span>
<span><span class="co">## Number of observations</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5000</span> </span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">locs_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Random sampling</span></span>
<span><span class="va">seed_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34521</span>, <span class="fl">323</span>,<span class="fl">43454</span>,<span class="fl">24213</span>,<span class="fl">2311</span>,<span class="fl">2344</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed_2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">locs_mll</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">world_poly_planar</span>, <span class="va">n</span>, type <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                                 oriented<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                                 exact <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Transform data locations to the longlat projection</span></span>
<span><span class="va">locs_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">locs_ll</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">locs_mll</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">world_poly_wgs84</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Point out that we need to exclude all points that are inside a
barrier, as our response variable cannot be observed inside.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Identify locations outside the world polygon in Mollweide projection</span></span>
<span><span class="va">ilocs_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">locs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ilocs_in</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">(</span></span>
<span>    <span class="va">locs_mll</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">world_barrier</span><span class="op">)</span>, <span class="va">length</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="co">## extract the coordinates</span></span>
<span>  <span class="va">locs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">locs_ll</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">ilocs_in</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Furthermore, we transform the points onto the sphere using the
<strong>fm_transform</strong> function, allowing us to fit the model
later on in 3D.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Map the data locations back to the sphere</span></span>
<span><span class="va">locs_sph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">locs_sph</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_transform.html" class="external-link">fm_transform</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">locs_mll</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">ilocs_in</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="st">"sphere"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizelocs-1.png" class="r-plt" alt="Spatial points where we have observed the response variable" width="700"><p class="caption">
Spatial points where we have observed the response variable
</p>
</div>
</div>
<div class="section level2">
<h2 id="covariate-depth">Covariate: depth<a class="anchor" aria-label="anchor" href="#covariate-depth"></a>
</h2>
<p>Here, we aim to include a continuous covariate with a linear effect.
For that, we are going to use the ocean depth and consider a negative
linear effect. Note that to download the depth data, you need to run
this in R outside of Quarto or Rmarkdown. You only need to do this
once.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depth_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">depth_values</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/get_depth.html" class="external-link">get_depth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">locs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We have some missing data, so we are going to eliminate those
locations that do not have any depth associated.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a new data frame 'locs_latlong' with columns 'x', 'y', and 'depth'</span></span>
<span><span class="va">locs_latlong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">depth_values</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">X</span>,</span>
<span>                           y <span class="op">=</span> <span class="va">depth_values</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                           depth <span class="op">=</span> <span class="va">depth_values</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Use 'depth' in kilometers for easier interpretation in the 'locs_latlong' data frame</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">depth</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Remove rows with missing values in the 'locs_latlong' data frame</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Calculate the new number of rows in the modified 'locs_latlong' data frame</span></span>
<span><span class="va">n_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_new</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Create a spatial features object (sf) </span></span>
<span><span class="va">depth_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">depth_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">depth_sf</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, crs <span class="op">=</span> <span class="va">crs_ll</span><span class="op">)</span></span>
<span> <span class="va">depth_mll</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">depth_sf</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, crs <span class="op">=</span> <span class="va">crs_vis</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Finally, after removing all the missing data, we can update the
previously simulated locations to retain only points where we have a
corresponding depth value. We have projected the filtered locations onto
the sphere using the <strong>fm_transform</strong> function.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Transform from data.frame to sf object</span></span>
<span><span class="va">locs_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">locs_filter</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                               coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="va">crs_ll</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Map the data locations back to the sphere</span></span>
<span><span class="va">locs_sph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">locs_sph</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_transform.html" class="external-link">fm_transform</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">locs_filter</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_crs.html" class="external-link">fm_crs</a></span><span class="op">(</span><span class="st">"sphere"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualize_depth-1.png" class="r-plt" alt="Scale values of depth in the selected locations" width="700"><p class="caption">
Scale values of depth in the selected locations
</p>
</div>
</div>
<div class="section level2">
<h2 id="response-variable-space-and-space-time">Response variable space and space-time<a class="anchor" aria-label="anchor" href="#response-variable-space-and-space-time"></a>
</h2>
<p>In this tutorial, we will fit four different scenarios: 1) a spatial
Normal response variable, 2) a spatial Bernoulli response variable, 3) a
space-time Normal response variable, and 4) a space-time Bernoulli
response variable. Therefore, we have two spatial scenarios and another
two space-time scenarios. Likewise, we will illustrate how to fit Normal
and Bernoulli distributions.</p>
<div class="section level3">
<h3 id="space-time-response-variables">Space-time response variables<a class="anchor" aria-label="anchor" href="#space-time-response-variables"></a>
</h3>
<p>Next, we are going to simulate the same response variables, but
including the time effect. Therefore, we will have two different
space-time datasets: one for a Normal response variable and another one
with a Bernoulli response variable.</p>
<div class="section level4">
<h4 id="normal-distribution">Normal distribution<a class="anchor" aria-label="anchor" href="#normal-distribution"></a>
</h4>
<p>For the normal response variable, we will use all the simulated
random fields. Subsequently, we will prepare a data.frame with the
coordinates in the sphere and values of depth and the simulated response
at those coordinates for fitting the model.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create sparse precision matrices for data locations</span></span>
<span><span class="va">Alocs_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">Alocs_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.A.html" class="external-link">inla.spde.make.A</a></span><span class="op">(</span></span>
<span>    mesh <span class="op">=</span> <span class="va">smesh</span>, loc <span class="op">=</span> <span class="va">locs_sph</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Set parameters for data simulation</span></span>
<span><span class="va">beta0_norm</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co">## Intercept</span></span>
<span><span class="va">beta1_norm</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.5</span> <span class="co">## Depth coefficient</span></span>
<span><span class="va">sigma_e</span> <span class="op">&lt;-</span> <span class="fl">0.3</span> <span class="co">## Gaussian standard deviation</span></span>
<span></span>
<span><span class="co">## Simulate the response variable y</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">356</span><span class="op">)</span></span>
<span><span class="va">y_norm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y_norm_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_new</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">beta0_norm</span> <span class="op">+</span></span>
<span>                           <span class="va">beta1_norm</span> <span class="op">*</span> <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">depth</span> <span class="op">+</span></span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">Alocs_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">u_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="va">sigma_e</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Create a data frame for the simulated data</span></span>
<span><span class="va">data_f_norm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">data_f_norm_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    z <span class="op">=</span> <span class="va">y_norm_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="va">crs_ll</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Visualize the simulated data on the Mollweide projection</span></span>
<span><span class="va">data_mll_norm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">locs_mll_data_norm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">data_mll_norm_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">data_f_norm_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, crs <span class="op">=</span> <span class="va">crs_vis</span><span class="op">)</span></span>
<span><span class="va">locs_mll_data_norm_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">data_mll_norm_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Combine data from all time steps for modeling</span></span>
<span><span class="va">data_model_norm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="va">locs_sph</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">y_response</span> <span class="op">&lt;-</span> <span class="va">data_mll_norm_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">z</span></span>
<span>  <span class="va">depth</span> <span class="op">&lt;-</span> <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">depth</span></span>
<span>  </span>
<span>  <span class="va">data_model_norm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">data_model_norm_t</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">y_response</span>,</span>
<span>    depth <span class="op">=</span> <span class="va">depth</span>, </span>
<span>    x_coord <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>    y_coord <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>    z_coord <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> </span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizeG-1.png" class="r-plt" alt="Values of the response variable over the space and time" width="700"><p class="caption">
Values of the response variable over the space and time
</p>
</div>
</div>
<div class="section level4">
<h4 id="bernouilli-distribution">Bernouilli distribution<a class="anchor" aria-label="anchor" href="#bernouilli-distribution"></a>
</h4>
<p>Then, for the Bernoulli distribution, we follow the same steps, but
considering the probability as the parameter of interest.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Set parameters for data simulation</span></span>
<span><span class="va">beta0_ber</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co">## Intercept</span></span>
<span><span class="va">beta1_ber</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.5</span> <span class="co">## Depth coefficient</span></span>
<span></span>
<span><span class="co">## Simulated probability</span></span>
<span><span class="va">p_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">boot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boot/man/inv.logit.html" class="external-link">inv.logit</a></span><span class="op">(</span><span class="va">beta0_ber</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta1_ber</span> <span class="op">*</span> <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">depth</span> <span class="op">+</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">Alocs_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">u_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Data.frame with the probability</span></span>
<span><span class="va">data_prob_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data_prob_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                        prob <span class="op">=</span> <span class="va">p_time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">356</span><span class="op">)</span></span>
<span><span class="va">y_ber_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y_ber_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data_prob_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob</span><span class="op">)</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">data_prob_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob</span><span class="op">)</span></span>
<span>  <span class="va">data_prob_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">response</span> <span class="op">&lt;-</span> <span class="va">y_ber_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">## Create a data frame for the simulated data</span></span>
<span><span class="va">data_f_ber_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data_f_ber_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    z <span class="op">=</span> <span class="va">data_prob_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">response</span></span>
<span>  <span class="op">)</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="va">crs_ll</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Visualize the simulated data on the Mollweide projection</span></span>
<span><span class="va">data_mll_ber_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">locs_mll_ber_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">data_mll_ber_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">data_f_ber_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, crs <span class="op">=</span> <span class="va">crs_vis</span><span class="op">)</span></span>
<span><span class="va">locs_mll_ber_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">data_mll_ber_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Combine data from all time steps for modeling</span></span>
<span><span class="va">data_model_ber_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="va">locs_sph</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">y_response</span> <span class="op">&lt;-</span> <span class="va">data_mll_ber_t</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">z</span></span>
<span>  <span class="va">depth</span> <span class="op">&lt;-</span> <span class="va">locs_latlong</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">depth</span></span>
<span>  </span>
<span>  <span class="va">data_model_ber_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">data_model_ber_t</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">y_response</span>,</span>
<span>    depth <span class="op">=</span> <span class="va">depth</span>, </span>
<span>    x_coord <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>    y_coord <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>    z_coord <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizeB-1.png" class="r-plt" alt="Values of the response variable over the space and time" width="700"><p class="caption">
Values of the response variable over the space and time
</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="fit-the-barrier-model">Fit the barrier model<a class="anchor" aria-label="anchor" href="#fit-the-barrier-model"></a>
</h2>
<p>To begin, we define the model object using the
<strong>barrierModel.define</strong> function. In this step, we specify
details such as the mesh, the barrier, the PC priors for the random
field hyperparameters, and the fraction of the range when a barrier is
in close proximity. This will be the same for all the scenarios.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define a barrier model using the mesh and specified prior parameters</span></span>
<span><span class="va">bmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/barrierModel.define.html">barrierModel.define</a></span><span class="op">(</span></span>
<span>  mesh <span class="op">=</span> <span class="va">smesh</span>, <span class="co">## mesh in 3D</span></span>
<span>  barrier.triangles <span class="op">=</span> <span class="va">triBarrier</span>, <span class="co">## Barriers (world countries)</span></span>
<span>  prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="co">## P(range &lt; 0.5) = 0.1</span></span>
<span>  prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="co">## P(range &gt; 1) = 0.1</span></span>
<span>  range.fraction <span class="op">=</span> <span class="fl">0.008</span> <span class="co">## range at the barriers </span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We will fit the model using both the inla base code and inlabru. For
both approaches, it is necessary to create a data.frame containing the
three-dimensional location, depth values, and the simulated response
variable values.</p>
<div class="section level3">
<h3 id="spatial-scenarios">Spatial scenarios<a class="anchor" aria-label="anchor" href="#spatial-scenarios"></a>
</h3>
<div class="section level4">
<h4 id="normal-response-variable">Normal response variable<a class="anchor" aria-label="anchor" href="#normal-response-variable"></a>
</h4>
<div class="section level5">
<h5 class="tabset" id="inlabru">INLABRU<a class="anchor" aria-label="anchor" href="#inlabru"></a>
</h5>
<p>We use the model formula in the inlabru way, where <em>field</em>
will be the name of the spatial effect. The main function in inlabru is
<strong>bru</strong>, and we just need to specify the model formula
(<em>model</em>), the data (<em>dataset</em>), and the family
(<em>gaussian</em>). We also turn on the <em>verbose</em> argument to be
able to see the fitting process while it is running.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the model formula</span></span>
<span><span class="va">model_norm</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span></span>
<span>  <span class="co">## Intercept</span></span>
<span>  <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Depth linear effect</span></span>
<span>  <span class="fu">bat</span><span class="op">(</span><span class="va">depth</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Spatial effect</span></span>
<span>  <span class="fu">field</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x_coord</span>,<span class="va">y_coord</span>,<span class="va">z_coord</span><span class="op">)</span>,</span>
<span>        model <span class="op">=</span> <span class="va">bmodel</span> <span class="co">#The barrier model</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="co">## Fit the Bayesian model using INLA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2353</span><span class="op">)</span></span>
<span><span class="va">result_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru</a></span><span class="op">(</span></span>
<span>    <span class="va">model_norm</span>, <span class="va">data_model_norm_t</span><span class="op">[</span><span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cpo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Once we have fitted the model, we can observe if we get back the
results. First, we check the summary of the fixed effect and the
hyperparameters.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Beta 0 (intercept) and Beta 1 (depth)</span></span>
<span><span class="va">res_summary_fixed_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_norm</span><span class="op">$</span><span class="va">summary.fixed</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of fixed
effects.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
<th align="right">kld</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">10.08</td>
<td align="right">0.18</td>
<td align="right">9.72</td>
<td align="right">10.08</td>
<td align="right">10.43</td>
<td align="right">10.08</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">bat</td>
<td align="right">-1.50</td>
<td align="right">0.01</td>
<td align="right">-1.51</td>
<td align="right">-1.50</td>
<td align="right">-1.48</td>
<td align="right">-1.50</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Range, standard deviation (spatial effect), and standard deviation (Gaussian)</span></span>
<span><span class="va">res_summary_hyper_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_norm</span><span class="op">$</span><span class="va">summary.hyperpar</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of
hyperparameters</caption>
<colgroup>
<col width="45%">
<col width="6%">
<col width="5%">
<col width="12%">
<col width="10%">
<col width="12%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Precision for the Gaussian observations</td>
<td align="right">10.85</td>
<td align="right">0.36</td>
<td align="right">10.16</td>
<td align="right">10.84</td>
<td align="right">11.57</td>
<td align="right">10.83</td>
</tr>
<tr class="even">
<td align="left">Theta1 for field</td>
<td align="right">-0.41</td>
<td align="right">0.08</td>
<td align="right">-0.56</td>
<td align="right">-0.41</td>
<td align="right">-0.23</td>
<td align="right">-0.42</td>
</tr>
<tr class="odd">
<td align="left">Theta2 for field</td>
<td align="right">0.05</td>
<td align="right">0.07</td>
<td align="right">-0.09</td>
<td align="right">0.05</td>
<td align="right">0.19</td>
<td align="right">0.04</td>
</tr>
</tbody>
</table>
<p>Then, we compute the marginals of the hyperparameters: range
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>,
standard deviation of the spatial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>,
and standard deviation of the Gaussian distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>e</mi></msub><annotation encoding="application/x-tex">\sigma_{e}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a list of hyperparameter marginals for visualization</span></span>
<span><span class="va">pmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma.e"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="va">result_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Log precision for the Gaussian observations`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"range"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta1 for field`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta2 for field`</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values and quantiles to hyperparameter marginals</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sigma_e</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ranges</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Likewise, we can plot the marginals for the fixed effects: intercept
and depth linear coefficients.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a list of parameter marginals for visualization</span></span>
<span><span class="va">fmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_norm</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">Intercept</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"depth"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_norm</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">bat</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values and quantiles to parameter marginals</span></span>
<span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta0_norm</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta1_norm</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also visualize the predicted random field. In this case, we
compute the mean of the spatial field and also the standard
deviation.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Add mean and standard deviation of the field to the grid </span></span>
<span><span class="va">grid_sf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">u_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span> <span class="co">## mean </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>      <span class="va">gproj</span>, </span>
<span>      <span class="va">result_norm</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">field</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_sf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">u_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span> <span class="co">## standard deviation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>    <span class="va">gproj</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">result_norm</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">field</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level6">
<h6 id="hyperparameters-posterior-distributions">Hyperparameters posterior distributions<a class="anchor" aria-label="anchor" href="#hyperparameters-posterior-distributions"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizepmargsG-1.png" class="r-plt" alt="Marginals posterior distributions for the hyperparameters (red line represents the true value)" width="700"><p class="caption">
Marginals posterior distributions for the hyperparameters (red line
represents the true value)
</p>
</div>
</div>
<div class="section level6">
<h6 id="fixed-parameters">Fixed parameters<a class="anchor" aria-label="anchor" href="#fixed-parameters"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizeFixedG-1.png" class="r-plt" alt="Marginals posterior distributions for the fixed parameters (red line represents the true value)" width="700"><p class="caption">
Marginals posterior distributions for the fixed parameters (red line
represents the true value)
</p>
</div>
</div>
<div class="section level6">
<h6 id="simulated-vs-posterior-mean-of-the-random-field">Simulated vs posterior mean of the random field<a class="anchor" aria-label="anchor" href="#simulated-vs-posterior-mean-of-the-random-field"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/simvspred-1.png" class="r-plt" alt="Simulated random field (u) compared to the posterior mean of the random field (u.mean)" width="700"><p class="caption">
Simulated random field (u) compared to the posterior mean of the random
field (u.mean)
</p>
</div>
</div>
<div class="section level6">
<h6 id="posterior-standard-deviation-of-the-field">Posterior standard deviation of the field<a class="anchor" aria-label="anchor" href="#posterior-standard-deviation-of-the-field"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/poststd-1.png" class="r-plt" alt="Posterior standard deviation of the random field with the observed points (black docs)" width="700"><p class="caption">
Posterior standard deviation of the random field with the observed
points (black docs)
</p>
</div>
</div>
</div>
<div class="section level5">
<h5 class="tabset" id="inla">INLA<a class="anchor" aria-label="anchor" href="#inla"></a>
</h5>
<p>The following code fits the model using the INLA base code. To
accomplish this, an INLA stack is initially created to model a response
variable according to a specified formula. This stack includes a
projector matrix (Alocs), spatial effect (i), depth (beta1), and an
intercept (beta0).</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create an INLA stack (stk) for modeling the response variable based on the specified formula and data</span></span>
<span><span class="va">stk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">data_model_norm_t</span><span class="op">[</span><span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="co">## Response variable</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Alocs_time</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,  <span class="co">## Projector matrix</span></span>
<span>  effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">bmodel</span><span class="op">$</span><span class="va">mesh</span><span class="op">$</span><span class="va">n</span>, <span class="co">## Spatial effect</span></span>
<span>                 beta1 <span class="op">=</span> <span class="va">data_model_norm_t</span><span class="op">[</span><span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">$</span><span class="va">depth</span>, <span class="co">## Depth </span></span>
<span>                 beta0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_model_norm_t</span><span class="op">[</span><span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">## Intercept</span></span>
<span>  <span class="op">)</span>,</span>
<span>  tag <span class="op">=</span> <span class="st">"est"</span> <span class="co">## Estimation stack (est)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Use inla to fit the specified formula and obtain the result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">52134</span><span class="op">)</span></span>
<span><span class="va">result_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">resp</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">beta0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">beta1</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">i</span>, model <span class="op">=</span> <span class="va">bmodel</span><span class="op">)</span>, <span class="co">## Formula</span></span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk</span><span class="op">)</span>, <span class="co">## Stack</span></span>
<span>            control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk</span><span class="op">)</span>,</span>
<span>                                     compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>return.marginals.predictor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Once we have fitted the model, we can observe if we get back the
results. First, we check the summary of the fixed effect and the
hyperparameters.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Beta 0 (intercept) and Beta 1 (depth)</span></span>
<span><span class="va">res_summary_fixed_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_norm</span><span class="op">$</span><span class="va">summary.fixed</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of fixed
effects.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
<th align="right">kld</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">beta0</td>
<td align="right">10.08</td>
<td align="right">0.18</td>
<td align="right">9.72</td>
<td align="right">10.08</td>
<td align="right">10.43</td>
<td align="right">10.08</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">beta1</td>
<td align="right">-1.50</td>
<td align="right">0.01</td>
<td align="right">-1.51</td>
<td align="right">-1.50</td>
<td align="right">-1.48</td>
<td align="right">-1.50</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Range, standard deviation (spatial effect), and standard deviation (Gaussian)</span></span>
<span><span class="va">res_summary_hyper_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_norm</span><span class="op">$</span><span class="va">summary.hyperpar</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of
hyperparameters</caption>
<colgroup>
<col width="45%">
<col width="6%">
<col width="5%">
<col width="12%">
<col width="10%">
<col width="12%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Precision for the Gaussian observations</td>
<td align="right">10.85</td>
<td align="right">0.36</td>
<td align="right">10.16</td>
<td align="right">10.84</td>
<td align="right">11.57</td>
<td align="right">10.83</td>
</tr>
<tr class="even">
<td align="left">Theta1 for i</td>
<td align="right">-0.41</td>
<td align="right">0.08</td>
<td align="right">-0.56</td>
<td align="right">-0.41</td>
<td align="right">-0.24</td>
<td align="right">-0.42</td>
</tr>
<tr class="odd">
<td align="left">Theta2 for i</td>
<td align="right">0.05</td>
<td align="right">0.07</td>
<td align="right">-0.09</td>
<td align="right">0.05</td>
<td align="right">0.19</td>
<td align="right">0.04</td>
</tr>
</tbody>
</table>
<p>Then, we compute the marginals of the hyperparameters: ranges
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>,
standard deviation of the spatial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>,
and standard deviation of the Gaussian distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>e</mi></msub><annotation encoding="application/x-tex">\sigma_{e}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a list of parameter marginals for visualization</span></span>
<span><span class="va">pmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma.e"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="va">result_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Log precision for the Gaussian observations`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"range"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta1 for i`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta2 for i`</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values to parameter marginals</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sigma_e</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ranges</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Likewise, we can plot the marginals for the fixed parameters:
intercept and depth linear coefficient.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a list of parameter marginals for visualization</span></span>
<span><span class="va">fmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_norm</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">beta0</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"depth"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_norm</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">beta1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values to parameter marginals</span></span>
<span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta0_norm</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta1_norm</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also visualize the predicted random field. In this case, we
compute the mean of the spatial field and also the standard
deviation.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Add mean and standard deviation of the field to the grid </span></span>
<span><span class="va">grid_sf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">u_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span> <span class="co">## mean </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>      <span class="va">gproj</span>, </span>
<span>      <span class="va">result_norm</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">i</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_sf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">u_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span> <span class="co">## standard deviation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>    <span class="va">gproj</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">result_norm</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">i</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level6">
<h6 id="hyperparameters-posterior-distributions-1">Hyperparameters posterior distributions<a class="anchor" aria-label="anchor" href="#hyperparameters-posterior-distributions-1"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizeh2-1.png" class="r-plt" alt="Marginals posterior distributions for the hyperparameters (red line represents the true value)" width="700"><p class="caption">
Marginals posterior distributions for the hyperparameters (red line
represents the true value)
</p>
</div>
</div>
<div class="section level6">
<h6 id="fixed-parameters-1">Fixed parameters<a class="anchor" aria-label="anchor" href="#fixed-parameters-1"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizefix2-1.png" class="r-plt" alt="Marginals posterior distributions for the fixed parameters (red line represents the true value)" width="700"><p class="caption">
Marginals posterior distributions for the fixed parameters (red line
represents the true value)
</p>
</div>
</div>
<div class="section level6">
<h6 id="simulated-vs-posterior-mean-of-the-random-field-1">Simulated vs posterior mean of the random field<a class="anchor" aria-label="anchor" href="#simulated-vs-posterior-mean-of-the-random-field-1"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/simvspred2-1.png" class="r-plt" alt="Simulated random field (u) compared to the posterior mean of the random field (u.mean)" width="700"><p class="caption">
Simulated random field (u) compared to the posterior mean of the random
field (u.mean)
</p>
</div>
</div>
<div class="section level6">
<h6 id="posterior-standard-deviation-of-the-field-1">Posterior standard deviation of the field<a class="anchor" aria-label="anchor" href="#posterior-standard-deviation-of-the-field-1"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/stdpost2-1.png" class="r-plt" alt="Posterior standard deviation of the random field with the observed points (black docs)" width="700"><p class="caption">
Posterior standard deviation of the random field with the observed
points (black docs)
</p>
</div>
</div>
</div>
<div class="section level5">
<h5 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h5>
<p>Another common objective with these models is to predict the response
variable in unsampled locations. Here, we share the code for predicting
with the barrier model across the Earth. Initially, we must download the
depth values for the locations we want to predict. In this case, we’ll
utilize the grid previously defined for projecting the random field.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extracting latitude and longitude from the defined grid</span></span>
<span><span class="va">locs_latlong_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/get_depth.html" class="external-link">get_depth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">grid_ll</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Scale the depth values (to km units) and storing them in the 'depth' column</span></span>
<span><span class="va">locs_latlong_pred</span><span class="op">$</span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">locs_latlong_pred</span><span class="op">$</span><span class="va">depth</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>Next, we have to set up the stack for prediction. Here, the response
variable is defined with NA (not available), and we replicate the same
effects present in the stack for estimation but with the updated depth
values. Lastly, we merge both stacks, combining those for estimation and
prediction.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create an inla.stack object for prediction</span></span>
<span><span class="va">stk.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, <span class="co">## Placeholder for the response variable (to be predicted)</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gproj</span><span class="op">$</span><span class="va">proj</span><span class="op">$</span><span class="va">A</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co">## Projection matrix for the spatial field and an intercept term</span></span>
<span>  effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">bmodel</span><span class="op">$</span><span class="va">mesh</span><span class="op">$</span><span class="va">n</span>, <span class="co">## Spatial random effect</span></span>
<span>                 beta1 <span class="op">=</span> <span class="va">locs_latlong_pred</span><span class="op">$</span><span class="va">depth</span>,</span>
<span>                 beta0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">locs_latlong_pred</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co">## Intercept term</span></span>
<span>  tag <span class="op">=</span> <span class="st">"pred"</span> <span class="co">## Tag for the stack, indicating it is used for prediction</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Combine the original stack (stk) with the prediction stack (stk.pred)</span></span>
<span><span class="va">stk.full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span><span class="va">stk</span>, <span class="va">stk.pred</span><span class="op">)</span></span></code></pre></div>
<p>Once we have our complete stack, we can rerun the model exclusively
for prediction, utilizing the previously fitted results (adjust this in
<em>control.mode</em>).</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Re-run the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">52134</span><span class="op">)</span></span>
<span><span class="va">res_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">resp</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">beta0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">beta1</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">i</span>, model <span class="op">=</span> <span class="va">bmodel</span><span class="op">)</span>, <span class="co">## Formula</span></span>
<span>                 data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.full</span><span class="op">)</span>, <span class="co">## Stack</span></span>
<span>                 control.mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">result_norm</span><span class="op">$</span><span class="va">mode</span><span class="op">$</span><span class="va">theta</span>, restart <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="co">##  Utilize the theta parameters obtained from the previously estimated spde model</span></span>
<span>                 control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.full</span><span class="op">)</span>,</span>
<span>                                          compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                 control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>return.marginals.predictor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In the end, we extract the predicted values from the model and
generate an sf object for visualization.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extracting the values of the response variable</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.index</a></span><span class="op">(</span><span class="va">stk.full</span>, <span class="st">"pred"</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">pred_values</span> <span class="op">&lt;-</span> <span class="va">res_pred</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">pred</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Creating a data frame with coordinates and predicted values</span></span>
<span><span class="va">data_raster_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">grid_ll</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                               y <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">grid_ll</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                               pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">pred_values</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Creating an sf object for visualization in Mollweide projection</span></span>
<span><span class="va">data_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_raster_pred</span>,</span>
<span>                      coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>,</span>
<span>                      crs <span class="op">=</span> <span class="va">crs_ll</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Transforming the sf object to the desired projection</span></span>
<span><span class="va">data_pred_mll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">data_pred</span>, crs <span class="op">=</span> <span class="va">crs_vis</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualixepredfit-1.png" class="r-plt" alt="Predicted response variable across the entire domain" width="700"><p class="caption">
Predicted response variable across the entire domain
</p>
</div>
</div>
</div>
<div class="section level4">
<h4 id="bernouilli-response-variable">Bernouilli response variable<a class="anchor" aria-label="anchor" href="#bernouilli-response-variable"></a>
</h4>
<p>We will use the same code provided for the normal response variable
to fit the Bernoulli distribution, with slight modifications to specify
the likelihood.</p>
<div class="section level5">
<h5 class="tabset" id="inlabru-1">INLABRU<a class="anchor" aria-label="anchor" href="#inlabru-1"></a>
</h5>
<p>First, we will establish the components of the model and indicate
that our response variable follows a Bernoulli distribution.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the model formula</span></span>
<span><span class="va">model_ber</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span></span>
<span>  <span class="co">## Intercept</span></span>
<span>  <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Depth linear effect</span></span>
<span>  <span class="fu">bat</span><span class="op">(</span><span class="va">depth</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Spatial effect</span></span>
<span>  <span class="fu">field</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x_coord</span>,<span class="va">y_coord</span>,<span class="va">z_coord</span><span class="op">)</span>,</span>
<span>        model <span class="op">=</span> <span class="va">bmodel</span> <span class="co">#The barrier model</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="co">## Fit the Bayesian model using INLA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2353</span><span class="op">)</span></span>
<span><span class="va">result_ber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/bru.html" class="external-link">bru</a></span><span class="op">(</span></span>
<span>    <span class="va">model_ber</span>, <span class="va">data_model_ber_t</span><span class="op">[</span><span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cpo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Once we have fitted the model, we can observe if we get back the
results. First, we check the summary of the fixed effect and the
hyperparameters.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Beta 0 (intercept) and Beta 1 (depth)</span></span>
<span><span class="va">res_summary_fixed_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_ber</span><span class="op">$</span><span class="va">summary.fixed</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of fixed
effects.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
<th align="right">kld</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">0.82</td>
<td align="right">0.44</td>
<td align="right">-0.05</td>
<td align="right">0.82</td>
<td align="right">1.73</td>
<td align="right">0.82</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">bat</td>
<td align="right">-1.34</td>
<td align="right">0.07</td>
<td align="right">-1.48</td>
<td align="right">-1.34</td>
<td align="right">-1.20</td>
<td align="right">-1.34</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Range, standard deviation (spatial effect), and standard deviation (Gaussian)</span></span>
<span><span class="va">res_summary_hyper_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_ber</span><span class="op">$</span><span class="va">summary.hyperpar</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of
hyperparameters</caption>
<colgroup>
<col width="26%">
<col width="9%">
<col width="7%">
<col width="16%">
<col width="13%">
<col width="16%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Theta1 for field</td>
<td align="right">0.12</td>
<td align="right">0.25</td>
<td align="right">-0.36</td>
<td align="right">0.11</td>
<td align="right">0.63</td>
<td align="right">0.09</td>
</tr>
<tr class="even">
<td align="left">Theta2 for field</td>
<td align="right">-0.08</td>
<td align="right">0.16</td>
<td align="right">-0.39</td>
<td align="right">-0.08</td>
<td align="right">0.22</td>
<td align="right">-0.08</td>
</tr>
</tbody>
</table>
<p>Then, we compute the marginals of the hyperparameters: ranges
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
and standard deviation of the spatial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a list of parameter marginals for visualization</span></span>
<span><span class="va">pmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"range"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ber</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta1 for field`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ber</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta2 for field`</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values to parameter marginals</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ranges</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Likewise, we can plot the marginals for the fixed effects: intercept
and depth linear coefficients.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a list of parameter marginals for visualization</span></span>
<span><span class="va">fmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_ber</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">Intercept</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"depth"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_ber</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">bat</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values to parameter marginals</span></span>
<span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta0_ber</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta1_ber</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also visualize the predicted random field. In this case, we
compute the mean of the spatial field and also the standard
deviation.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Add mean and standard deviation of the field to the grid </span></span>
<span><span class="va">grid_sf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">u_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span> <span class="co">## mean </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>      <span class="va">gproj</span>, </span>
<span>      <span class="va">result_ber</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">field</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_sf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">u_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span> <span class="co">## standard deviation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>    <span class="va">gproj</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">result_ber</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">field</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level6">
<h6 id="hyperparameters-posterior-distributions-2">Hyperparameters posterior distributions<a class="anchor" aria-label="anchor" href="#hyperparameters-posterior-distributions-2"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizepmargsB-1.png" class="r-plt" alt="Marginals posterior distributions for the hyperparameters (red line represents the true value)" width="700"><p class="caption">
Marginals posterior distributions for the hyperparameters (red line
represents the true value)
</p>
</div>
</div>
<div class="section level6">
<h6 id="fixed-parameters-2">Fixed parameters<a class="anchor" aria-label="anchor" href="#fixed-parameters-2"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizefixedB-1.png" class="r-plt" alt="Marginals posterior distributions for the fixed parameters (red line represents the true value)" width="700"><p class="caption">
Marginals posterior distributions for the fixed parameters (red line
represents the true value)
</p>
</div>
</div>
<div class="section level6">
<h6 id="simulated-vs-posterior-mean-of-the-random-field-2">Simulated vs posterior mean of the random field<a class="anchor" aria-label="anchor" href="#simulated-vs-posterior-mean-of-the-random-field-2"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/simvspredB-1.png" class="r-plt" alt="Simulated random field (u) compared to the posterior mean of the random field (u.mean)" width="700"><p class="caption">
Simulated random field (u) compared to the posterior mean of the random
field (u.mean)
</p>
</div>
</div>
<div class="section level6">
<h6 id="posterior-standard-deviation-of-the-field-2">Posterior standard deviation of the field<a class="anchor" aria-label="anchor" href="#posterior-standard-deviation-of-the-field-2"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizepredB-1.png" class="r-plt" alt="Posterior standard deviation of the random field with the observed points (black docs)" width="700"><p class="caption">
Posterior standard deviation of the random field with the observed
points (black docs)
</p>
</div>
</div>
</div>
<div class="section level5">
<h5 class="tabset" id="inla-1">INLA<a class="anchor" aria-label="anchor" href="#inla-1"></a>
</h5>
<p>The following code fits the model using the INLA base code. To
accomplish this, an INLA stack is initially created to model a response
variable according to a specified formula. This stack includes a
projector matrix (Alocs), spatial effect (i), depth (beta1), and an
intercept (beta0).</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create an INLA stack (stk) for modeling the response variable based on the specified formula and data</span></span>
<span><span class="va">stk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">data_model_ber_t</span><span class="op">[</span><span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="co">## Response variable</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Alocs_time</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,  <span class="co">## Projector matrix</span></span>
<span>  effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">bmodel</span><span class="op">$</span><span class="va">mesh</span><span class="op">$</span><span class="va">n</span>, <span class="co">## Spatial effect</span></span>
<span>                 beta1 <span class="op">=</span> <span class="va">data_model_ber_t</span><span class="op">[</span><span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">$</span><span class="va">depth</span>, <span class="co">## Depth </span></span>
<span>                 beta0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_model_ber_t</span><span class="op">[</span><span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">## Intercept</span></span>
<span>  <span class="op">)</span>,</span>
<span>  tag <span class="op">=</span> <span class="st">"est"</span> <span class="co">## Estimation stack (est)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Use inla to fit the specified formula and obtain the result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">52134</span><span class="op">)</span></span>
<span><span class="va">result_ber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">resp</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">beta0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">beta1</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">i</span>, model <span class="op">=</span> <span class="va">bmodel</span><span class="op">)</span>, <span class="co">## Formula</span></span>
<span>               data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk</span><span class="op">)</span>, <span class="co">## Stack</span></span>
<span>               family <span class="op">=</span> <span class="st">'binomial'</span>,</span>
<span>               control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk</span><span class="op">)</span>,</span>
<span>                                        compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>return.marginals.predictor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Once we have fitted the model, we can observe if we get back the
results. First, we check the summary of the fixed effect and the
hyperparameters.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Beta 0 (intercept) and Beta 1 (depth)</span></span>
<span><span class="va">res_summary_fixed_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_ber</span><span class="op">$</span><span class="va">summary.fixed</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of fixed
effects.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
<th align="right">kld</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">beta0</td>
<td align="right">0.82</td>
<td align="right">0.44</td>
<td align="right">-0.05</td>
<td align="right">0.82</td>
<td align="right">1.73</td>
<td align="right">0.82</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">beta1</td>
<td align="right">-1.34</td>
<td align="right">0.07</td>
<td align="right">-1.48</td>
<td align="right">-1.34</td>
<td align="right">-1.20</td>
<td align="right">-1.34</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Range, standard deviation (spatial effect), and standard deviation (Gaussian)</span></span>
<span><span class="va">res_summary_hyper_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_ber</span><span class="op">$</span><span class="va">summary.hyperpar</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of
hyperparameters</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Theta1 for i</td>
<td align="right">0.12</td>
<td align="right">0.25</td>
<td align="right">-0.36</td>
<td align="right">0.11</td>
<td align="right">0.63</td>
<td align="right">0.09</td>
</tr>
<tr class="even">
<td align="left">Theta2 for i</td>
<td align="right">-0.08</td>
<td align="right">0.16</td>
<td align="right">-0.39</td>
<td align="right">-0.08</td>
<td align="right">0.22</td>
<td align="right">-0.08</td>
</tr>
</tbody>
</table>
<p>Then, we compute the marginals of the hyperparameters: ranges
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
and standard deviation of the spatial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a list of parameter marginals for visualization</span></span>
<span><span class="va">pmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"range"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ber</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta1 for i`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ber</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta2 for i`</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values to parameter marginals</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ranges</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Likewise, we can plot the marginals for the fixed effects: intercept
and depth linear coefficients.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a list of parameter marginals for visualization</span></span>
<span><span class="va">fmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_ber</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">beta0</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"depth"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_ber</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">beta1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values to parameter marginals</span></span>
<span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta0_ber</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta1_ber</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also visualize the predicted random field. In this case, we
compute the mean of the spatial field and also the standard
deviation.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Add mean and standard deviation of the field to the grid </span></span>
<span><span class="va">grid_sf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">u_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span> <span class="co">## mean </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>      <span class="va">gproj</span>, </span>
<span>      <span class="va">result_ber</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">i</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_sf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">u_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span> <span class="co">## standard deviation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span></span>
<span>    <span class="va">gproj</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">result_ber</span><span class="op">$</span><span class="va">summary.random</span><span class="op">$</span><span class="va">i</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level6">
<h6 id="hyperparameters-posterior-distributions-3">Hyperparameters posterior distributions<a class="anchor" aria-label="anchor" href="#hyperparameters-posterior-distributions-3"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizehyperBinla-1.png" class="r-plt" alt="Marginals posterior distributions for the hyperparameters (red line represents the true value)" width="700"><p class="caption">
Marginals posterior distributions for the hyperparameters (red line
represents the true value)
</p>
</div>
</div>
<div class="section level6">
<h6 id="fixed-parameters-3">Fixed parameters<a class="anchor" aria-label="anchor" href="#fixed-parameters-3"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizefixBinla-1.png" class="r-plt" alt="Marginals posterior distributions for the fixed parameters (red line represents the true value)" width="700"><p class="caption">
Marginals posterior distributions for the fixed parameters (red line
represents the true value)
</p>
</div>
</div>
<div class="section level6">
<h6 id="simulated-vs-posterior-mean-of-the-random-field-3">Simulated vs posterior mean of the random field<a class="anchor" aria-label="anchor" href="#simulated-vs-posterior-mean-of-the-random-field-3"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/simvspredBinla-1.png" class="r-plt" alt="Simulated random field (u) compared to the posterior mean of the random field (u.mean)" width="700"><p class="caption">
Simulated random field (u) compared to the posterior mean of the random
field (u.mean)
</p>
</div>
</div>
<div class="section level6">
<h6 id="posterior-standard-deviation-of-the-field-3">Posterior standard deviation of the field<a class="anchor" aria-label="anchor" href="#posterior-standard-deviation-of-the-field-3"></a>
</h6>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizestdBinla-1.png" class="r-plt" alt="Posterior standard deviation of the random field with the observed points (black docs)" width="700"><p class="caption">
Posterior standard deviation of the random field with the observed
points (black docs)
</p>
</div>
</div>
</div>
<div class="section level5">
<h5 id="prediction-1">Prediction<a class="anchor" aria-label="anchor" href="#prediction-1"></a>
</h5>
<p>Now, we will predict the probability of presence according to the
fitted model.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extracting latitude and longitude from the defined grid</span></span>
<span><span class="va">locs_latlong_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/get_depth.html" class="external-link">get_depth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">grid_ll</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Scale the depth values (km units) and storing them in the 'depth' column</span></span>
<span><span class="va">locs_latlong_pred</span><span class="op">$</span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">locs_latlong_pred</span><span class="op">$</span><span class="va">depth</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>Next, we have to set up the stack for prediction. Here, the respons
variable is defined with NA (not available), and we replicate the same
effects present in the stack for estimation but with the updated depth
values. Lastly, we merge both stacks, combining those for estimation and
prediction.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create an inla.stack object for prediction</span></span>
<span><span class="va">stk.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, <span class="co">## Placeholder for the response variable (to be predicted)</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gproj</span><span class="op">$</span><span class="va">proj</span><span class="op">$</span><span class="va">A</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co">## Projection matrix for the spatial field and an intercept term</span></span>
<span>  effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">bmodel</span><span class="op">$</span><span class="va">mesh</span><span class="op">$</span><span class="va">n</span>, <span class="co">## Spatial random effect</span></span>
<span>                 beta1 <span class="op">=</span> <span class="va">locs_latlong_pred</span><span class="op">$</span><span class="va">depth</span>,</span>
<span>                 beta0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">locs_latlong_pred</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co">## Intercept term</span></span>
<span>  tag <span class="op">=</span> <span class="st">"pred"</span> <span class="co">## Tag for the stack, indicating it is used for prediction</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Combine the original stack (stk) with the prediction stack (stk.pred)</span></span>
<span><span class="va">stk.full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span><span class="va">stk</span>, <span class="va">stk.pred</span><span class="op">)</span></span></code></pre></div>
<p>Once we have our complete stack, we can rerun the model exclusively
for prediction, utilizing the previously fitted results (adjust this in
<em>control.mode</em>).</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Re-run the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">52134</span><span class="op">)</span></span>
<span><span class="va">res_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">resp</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">beta0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">beta1</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">i</span>, model <span class="op">=</span> <span class="va">bmodel</span><span class="op">)</span>, <span class="co">## Formula</span></span>
<span>                 data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.full</span><span class="op">)</span>, <span class="co">## Stack</span></span>
<span>                 family <span class="op">=</span> <span class="st">'binomial'</span>,</span>
<span>                 control.mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">result_ber</span><span class="op">$</span><span class="va">mode</span><span class="op">$</span><span class="va">theta</span>, restart <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="co">##  Utilize the theta parameters obtained from the previously estimated spde model</span></span>
<span>                 control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.full</span><span class="op">)</span>,</span>
<span>                                          compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                 control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>return.marginals.predictor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In the end, we extract the predicted values from the model and
generate an sf object for visualization.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extracting the values of the response variable</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.index</a></span><span class="op">(</span><span class="va">stk.full</span>, <span class="st">"pred"</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">pred_values</span> <span class="op">&lt;-</span> <span class="va">res_pred</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="va">pred</span><span class="op">]</span></span>
<span><span class="va">pred_values_presences</span> <span class="op">&lt;-</span> <span class="fu">boot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boot/man/inv.logit.html" class="external-link">inv.logit</a></span><span class="op">(</span><span class="va">pred_values</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Creating a data frame with coordinates and predicted values</span></span>
<span><span class="va">data_raster_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">grid_ll</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                               y <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">grid_ll</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                               pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">pred_values_presences</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Creating an sf object for visualization in Mollweide projection</span></span>
<span><span class="va">data_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_raster_pred</span>,</span>
<span>                      coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>,</span>
<span>                      crs <span class="op">=</span> <span class="va">crs_ll</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Transforming the sf object to the desired projection</span></span>
<span><span class="va">data_pred_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">data_pred</span>, crs <span class="op">=</span> <span class="va">crs_vis</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizepredBinla-1.png" class="r-plt" alt="Predicted response variable across the entire domain" width="700"><p class="caption">
Predicted response variable across the entire domain
</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="space-time-scenarios">Space-time scenarios<a class="anchor" aria-label="anchor" href="#space-time-scenarios"></a>
</h3>
<p>After fitting and predicting only in space, we are now going to
implement a separable space-time model, as illustrated in Krainski et
al., 2018. Essentially, we will include the autoregressive model of
order 1 into the spatial effect. As we did with the space examples, we
will fit two different likelihoods (Gaussian and Bernoulli). Then, as
displayed in the code, we will include an autoregressive term of order 1
with <em>model = “ar1”</em>, where the probability of the parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
being greater than 0 is 0.9.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define formula for the space-time effect</span></span>
<span><span class="va">rho.prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">'pc.cor1'</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="co">## P(rho&gt;0) = 0.9</span></span>
<span><span class="va">form.barrier.st_ar1</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">intercept</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">beta1</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">i</span>, model <span class="op">=</span> <span class="va">bmodel</span>, group <span class="op">=</span> <span class="va">time</span>,</span>
<span>    control.group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>                         hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">rho.prior</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 class="tabset" id="normal-response-variable-1">Normal response variable<a class="anchor" aria-label="anchor" href="#normal-response-variable-1"></a>
</h4>
<p>The code for fitting a spatio-temporal scenario is almost the same as
in the spatial example; we just include the effect of time in the
projector matrix and also in the stack.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## space-time projector matrix</span></span>
<span><span class="va">A.st_norm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.A.html" class="external-link">inla.spde.make.A</a></span><span class="op">(</span></span>
<span>  mesh <span class="op">=</span> <span class="va">smesh</span>,</span>
<span>  loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">x_coord</span>,</span>
<span>              <span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">y_coord</span>,</span>
<span>              <span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">z_coord</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Stack data for modeling</span></span>
<span><span class="va">stk.st_norm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,</span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A.st_norm_t</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bmodel</span><span class="op">$</span><span class="va">f</span><span class="op">$</span><span class="va">n</span>, <span class="va">k</span><span class="op">)</span>,</span>
<span>         time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, each <span class="op">=</span> <span class="va">bmodel</span><span class="op">$</span><span class="va">f</span><span class="op">$</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             beta1 <span class="op">=</span> <span class="va">data_model_norm_t</span><span class="op">$</span><span class="va">depth</span>,</span>
<span>    intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data_model_norm_t</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For the fitting, we use the <em>inla</em> function and specify the
family as <em>“gaussian”</em> for this particular simulation.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit spatial-temporal model with AR1 correlation structure</span></span>
<span><span class="va">result_ar1_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">form.barrier.st_ar1</span>,</span>
<span>                   data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.st_norm_t</span><span class="op">)</span>,</span>
<span>                   family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.st_norm_t</span><span class="op">)</span>,</span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>return.marginals.predictor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Then, we can display the main statistical measures for the estimation
of the hyperparameters and parameters.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Print summary of fixed effects</span></span>
<span><span class="va">res_summary_fixed_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_ar1_norm</span><span class="op">$</span><span class="va">summary.fixed</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">res_summary_fixed_rounded</span>, caption <span class="op">=</span> <span class="st">"Summary of the posterior distribution of fixed effects."</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of fixed
effects.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
<th align="right">kld</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">intercept</td>
<td align="right">9.85</td>
<td align="right">0.12</td>
<td align="right">9.61</td>
<td align="right">9.85</td>
<td align="right">10.09</td>
<td align="right">9.85</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">beta1</td>
<td align="right">-1.50</td>
<td align="right">0.00</td>
<td align="right">-1.51</td>
<td align="right">-1.50</td>
<td align="right">-1.50</td>
<td align="right">-1.50</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Print summary of hyperparameters</span></span>
<span><span class="va">res_summary_hyper_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_ar1_norm</span><span class="op">$</span><span class="va">summary.hyperpar</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">res_summary_hyper_rounded</span>, caption <span class="op">=</span> <span class="st">"Summary of the posterior distribution of hyperparameters"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of
hyperparameters</caption>
<colgroup>
<col width="45%">
<col width="6%">
<col width="5%">
<col width="12%">
<col width="10%">
<col width="12%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Precision for the Gaussian observations</td>
<td align="right">11.15</td>
<td align="right">0.13</td>
<td align="right">10.90</td>
<td align="right">11.15</td>
<td align="right">11.41</td>
<td align="right">11.14</td>
</tr>
<tr class="even">
<td align="left">Theta1 for i</td>
<td align="right">-0.45</td>
<td align="right">0.05</td>
<td align="right">-0.54</td>
<td align="right">-0.45</td>
<td align="right">-0.37</td>
<td align="right">-0.44</td>
</tr>
<tr class="odd">
<td align="left">Theta2 for i</td>
<td align="right">0.03</td>
<td align="right">0.04</td>
<td align="right">-0.06</td>
<td align="right">0.03</td>
<td align="right">0.11</td>
<td align="right">0.04</td>
</tr>
<tr class="even">
<td align="left">GroupRho for i</td>
<td align="right">0.98</td>
<td align="right">0.00</td>
<td align="right">0.98</td>
<td align="right">0.98</td>
<td align="right">0.98</td>
<td align="right">0.98</td>
</tr>
</tbody>
</table>
<p>We also compute the marginal distribution for the hyperparameters and
parameters, so we can compare the results obtained with the simulated
case.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot marginal posterior distributions of hyperparameters</span></span>
<span><span class="va">pmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"range"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ar1_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta1 for i`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ar1_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta2 for i`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma_e"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ar1_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Log precision for the Gaussian observations`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"rho"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ar1_norm</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Group rho_intern for i`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_ar1_norm</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">intercept</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"beta1"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_ar1_norm</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">beta1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values to parameter marginals</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ranges</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sigma</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sigma_e</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rho</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta0_norm</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta1_norm</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"param"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"true"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"param"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"true"</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="parameter-and-hyperparameters-posterior-distributions">Parameter and hyperparameters posterior distributions<a class="anchor" aria-label="anchor" href="#parameter-and-hyperparameters-posterior-distributions"></a>
</h5>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/visualizestGmargs-1.png" class="r-plt" alt="Posterior distribution of parameters and hyperparameters, where, beta1 represents the coefficient for the depth covariate, rho represents the correlation parameter for the autoregressive model of order 1, sigma represents the standard deviation of the random field, and sigma.e represents the standard deviation of the Gaussian distribution." width="700"><p class="caption">
Posterior distribution of parameters and hyperparameters, where, beta1
represents the coefficient for the depth covariate, rho represents the
correlation parameter for the autoregressive model of order 1, sigma
represents the standard deviation of the random field, and sigma.e
represents the standard deviation of the Gaussian distribution.
</p>
</div>
</div>
<div class="section level5">
<h5 id="predited-random-fields">Predited random fields<a class="anchor" aria-label="anchor" href="#predited-random-fields"></a>
</h5>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/stpred-1.png" class="r-plt" alt="Predicted random fields (u) for all years" width="700"><p class="caption">
Predicted random fields (u) for all years
</p>
</div>
</div>
</div>
<div class="section level4">
<h4 class="tabset" id="bernouilli-response-variable-1">Bernouilli response variable<a class="anchor" aria-label="anchor" href="#bernouilli-response-variable-1"></a>
</h4>
<p>The same framework as that for the Normal response variable can be
applied to the Bernoulli response variable. We simply need to change the
family in the <em>inla</em> function to <em>“binomial”</em>.
Consequently, we obtain similar outputs, but in this case, they
parameter of interest is a probability.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## space-time projector matrix</span></span>
<span><span class="va">A.st_ber_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.A.html" class="external-link">inla.spde.make.A</a></span><span class="op">(</span></span>
<span>  mesh <span class="op">=</span> <span class="va">smesh</span>,</span>
<span>  loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">x_coord</span>,</span>
<span>              <span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">y_coord</span>,</span>
<span>              <span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">z_coord</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Stack data for modeling</span></span>
<span><span class="va">stk.st_ber_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,</span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A.st_ber_t</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bmodel</span><span class="op">$</span><span class="va">f</span><span class="op">$</span><span class="va">n</span>, <span class="va">k</span><span class="op">)</span>,</span>
<span>         time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, each <span class="op">=</span> <span class="va">bmodel</span><span class="op">$</span><span class="va">f</span><span class="op">$</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             beta1 <span class="op">=</span> <span class="va">data_model_ber_t</span><span class="op">$</span><span class="va">depth</span>,</span>
<span>    intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data_model_ber_t</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Define formula for the space-time effect</span></span>
<span><span class="va">rho.prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">'pc.cor1'</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="co">### P(rho&gt;0) = 0.9</span></span>
<span><span class="va">form.barrier.st_ar1</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">intercept</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">beta1</span>, model <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">i</span>, model <span class="op">=</span> <span class="va">bmodel</span>, group <span class="op">=</span> <span class="va">time</span>,</span>
<span>    control.group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>                         hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">rho.prior</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Fit spatial-temporal model with AR1 correlation structure</span></span>
<span><span class="va">result_ar1_ber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">form.barrier.st_ar1</span>,</span>
<span>                   data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.st_ber_t</span><span class="op">)</span>,</span>
<span>                   family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.st_ber_t</span><span class="op">)</span>,</span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>return.marginals.predictor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Print summary of fixed effects</span></span>
<span><span class="va">res_summary_fixed_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_ar1_ber</span><span class="op">$</span><span class="va">summary.fixed</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">res_summary_fixed_rounded</span>, caption <span class="op">=</span> <span class="st">"Summary of the posterior distribution of fixed effects."</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of fixed
effects.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
<th align="right">kld</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">intercept</td>
<td align="right">0.77</td>
<td align="right">0.37</td>
<td align="right">-0.02</td>
<td align="right">0.79</td>
<td align="right">1.44</td>
<td align="right">0.85</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">beta1</td>
<td align="right">-1.43</td>
<td align="right">0.04</td>
<td align="right">-1.50</td>
<td align="right">-1.43</td>
<td align="right">-1.36</td>
<td align="right">-1.43</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Print summary of hyperparameters</span></span>
<span><span class="va">res_summary_hyper_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_ar1_ber</span><span class="op">$</span><span class="va">summary.hyperpar</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">res_summary_hyper_rounded</span>, caption <span class="op">=</span> <span class="st">"Summary of the posterior distribution of hyperparameters"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary of the posterior distribution of
hyperparameters</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">0.025quant</th>
<th align="right">0.5quant</th>
<th align="right">0.975quant</th>
<th align="right">mode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Theta1 for i</td>
<td align="right">-0.14</td>
<td align="right">0.16</td>
<td align="right">-0.45</td>
<td align="right">-0.14</td>
<td align="right">0.19</td>
<td align="right">-0.15</td>
</tr>
<tr class="even">
<td align="left">Theta2 for i</td>
<td align="right">0.11</td>
<td align="right">0.10</td>
<td align="right">-0.09</td>
<td align="right">0.11</td>
<td align="right">0.31</td>
<td align="right">0.10</td>
</tr>
<tr class="odd">
<td align="left">GroupRho for i</td>
<td align="right">0.99</td>
<td align="right">0.01</td>
<td align="right">0.96</td>
<td align="right">0.99</td>
<td align="right">1.00</td>
<td align="right">0.99</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot marginal posterior distributions of hyperparameters</span></span>
<span><span class="va">pmarginals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"range"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ar1_ber</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta1 for i`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"sigma"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ar1_ber</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Theta2 for i`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"rho"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span></span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="va">result_ar1_ber</span><span class="op">$</span><span class="va">internal.marginals.hyperpar</span><span class="op">$</span><span class="va">`Group rho_intern for i`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_ar1_ber</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">intercept</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      param <span class="op">=</span> <span class="st">"beta1"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">result_ar1_ber</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">$</span><span class="va">beta1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Add true values to parameter marginals</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ranges</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sigma</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rho</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta0_ber</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta1_ber</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"param"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"true"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pmarginals</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"param"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"true"</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="parameter-and-hyperparameters-posterior-distributions-1">Parameter and hyperparameters posterior distributions<a class="anchor" aria-label="anchor" href="#parameter-and-hyperparameters-posterior-distributions-1"></a>
</h5>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/stBhyper-1.png" class="r-plt" alt="Posterior distribution of parameters and hyperparameters, where, beta1 represents the coefficient for the depth covariate, rho represents the correlation parameter for the autoregressive model of order 1, and sigma represents the standar deviation of the random field." width="700"><p class="caption">
Posterior distribution of parameters and hyperparameters, where, beta1
represents the coefficient for the depth covariate, rho represents the
correlation parameter for the autoregressive model of order 1, and sigma
represents the standar deviation of the random field.
</p>
</div>
</div>
<div class="section level5">
<h5 id="predited-random-fields-1">Predited random fields<a class="anchor" aria-label="anchor" href="#predited-random-fields-1"></a>
</h5>
<div class="figure" style="text-align: center">
<img src="figures/barrier-global/stBpred-1.png" class="r-plt" alt="Predicted random fields (u) for all years" width="700"><p class="caption">
Predicted random fields (u) for all years
</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<pre><code><span><span class="co">## R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] ggpubr_0.6.2             DOYPAColors_0.0.2        s2_1.1.9                </span></span>
<span><span class="co">##  [4] ggOceanMaps_2.2.0        INLAspacetime_0.1.12.013 INLAtools_0.0.5         </span></span>
<span><span class="co">##  [7] inlabru_2.13.0           fmesher_0.5.0            ggplot2_4.0.1           </span></span>
<span><span class="co">## [10] sf_1.0-22                rnaturalearth_1.1.0      rmarkdown_2.30          </span></span>
<span><span class="co">## [13] knitr_1.50               INLA_25.11.22            Matrix_1.7-4            </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] gtable_0.3.6            xfun_0.54               bslib_0.9.0            </span></span>
<span><span class="co">##  [4] rstatix_0.7.3           lattice_0.22-7          vctrs_0.6.5            </span></span>
<span><span class="co">##  [7] tools_4.5.2             generics_0.1.4          spdep_1.4-1            </span></span>
<span><span class="co">## [10] parallel_4.5.2          tibble_3.3.0            proxy_0.4-27           </span></span>
<span><span class="co">## [13] pkgconfig_2.0.3         KernSmooth_2.23-26      RColorBrewer_1.1-3     </span></span>
<span><span class="co">## [16] S7_0.2.1                desc_1.4.3              lifecycle_1.0.4        </span></span>
<span><span class="co">## [19] deldir_2.0-4            compiler_4.5.2          farver_2.1.2           </span></span>
<span><span class="co">## [22] MatrixModels_0.5-4      textshaping_1.0.4       carData_3.0-5          </span></span>
<span><span class="co">## [25] stars_0.6-8             htmltools_0.5.8.1       class_7.3-23           </span></span>
<span><span class="co">## [28] sass_0.4.10             yaml_2.3.10             Formula_1.2-5          </span></span>
<span><span class="co">## [31] car_3.1-3               tidyr_1.3.1             pillar_1.11.1          </span></span>
<span><span class="co">## [34] pkgdown_2.2.0           jquerylib_0.1.4         classInt_0.4-11        </span></span>
<span><span class="co">## [37] cachem_1.1.0            wk_0.9.4                boot_1.3-32            </span></span>
<span><span class="co">## [40] abind_1.4-8             rnaturalearthdata_1.0.0 Deriv_4.2.0            </span></span>
<span><span class="co">## [43] tidyselect_1.2.1        digest_0.6.39           dplyr_1.1.4            </span></span>
<span><span class="co">## [46] purrr_1.2.0             labeling_0.4.3          splines_4.5.2          </span></span>
<span><span class="co">## [49] cowplot_1.2.0           fastmap_1.2.0           grid_4.5.2             </span></span>
<span><span class="co">## [52] cli_3.6.5               magrittr_2.0.4          broom_1.0.10           </span></span>
<span><span class="co">## [55] e1071_1.7-16            withr_3.0.2             backports_1.5.0        </span></span>
<span><span class="co">## [58] scales_1.4.0            sp_2.2-0                spData_2.3.4           </span></span>
<span><span class="co">## [61] gridExtra_2.3           ggsignif_0.6.4          ragg_1.5.0             </span></span>
<span><span class="co">## [64] evaluate_1.0.5          rlang_1.1.6             Rcpp_1.1.0             </span></span>
<span><span class="co">## [67] glue_1.8.0              DBI_1.2.3               jsonlite_2.0.0         </span></span>
<span><span class="co">## [70] plyr_1.8.9              R6_2.6.1                systemfonts_1.3.1      </span></span>
<span><span class="co">## [73] fs_1.6.6                units_1.0-0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Bakka, H., J. Vanhatalo, J. Illian, D. Simpson, and H. Rue. 2019.
“Non-Stationary Gaussian Models with Physical Barriers.” Spatial
Statistics 29 (March): 268–88. <a href="https://doi.org/https://doi.org/10.1016/j.spasta.2019.01.002" class="external-link uri">https://doi.org/https://doi.org/10.1016/j.spasta.2019.01.002</a>.</p></li>
<li><p>Lindgren, Finn, Håvard Rue, and Johan Lindström. 2011. “An
Explicit Link Between Gaussian Fields and Gaussian Markov Random Fields:
The Stochastic Partial Differential Equation Approach.” Journal of the
Royal Statistical Society: Series B (Statistical Methodology) 73 (4):
423–98. <a href="https://doi.org/10.1111/j.1467-9868.2011.00777.x" class="external-link uri">https://doi.org/10.1111/j.1467-9868.2011.00777.x</a>.</p></li>
<li><p>Krainski, E., Gómez-Rubio, V., Bakka, H., Lenzi, A.,
Castro-Camilo, D., Simpson, D., Lindgren, F. and Rue, H. (2018).
Advanced spatial modeling with stochastic partial differential equations
using R and INLA. Chapman and Hall/CRC.</p></li>
</ul>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Elias Teixeira Krainski, Finn Lindgren, Haavard Rue.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
